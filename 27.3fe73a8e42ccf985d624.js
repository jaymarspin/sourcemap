(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{yRgH:function(t,e,o){"use strict";o.r(e),o.d(e,"EditOpportunityPageModule",function(){return z});var n=o("ofXK"),i=o("3Pt+"),r=o("TEn/"),s=o("tyNb"),a=o("mrSG"),c=o("quSY"),p=o("Cfvw"),l=o("cp0P"),b=o("5+tZ"),m=o("vkgz"),u=o("v6Tj"),h=o("0tzy"),g=o("BInz"),d=o("Ghe0"),y=o("AytR"),f=o("SJsC"),v=o("7dZU"),M=o("M5gO"),C=o("HAHl"),N=o("fXoL"),P=o("sYmb"),F=o("nC5Y"),O=o("FpxV"),x=o("7zc5"),D=o("0C1u"),I=o("gE7l");function w(t,e){if(1&t&&(N.Nb(0,"ion-select-option",13),N.xc(1),N.Mb()),2&t){const t=e.$implicit;N.gc("value",t.value),N.xb(1),N.yc(t.label)}}function E(t,e){if(1&t&&(N.Nb(0,"ion-select-option",13),N.xc(1),N.Mb()),2&t){const t=e.$implicit;N.gc("value",t.value),N.xb(1),N.zc("",t.label," ")}}function S(t,e){if(1&t&&(N.Nb(0,"ion-item"),N.Nb(1,"ion-select",25),N.ac(2,"translate"),N.vc(3,E,2,2,"ion-select-option",11),N.Mb(),N.Mb()),2&t){const t=N.Zb(2);N.xb(1),N.hc("placeholder",N.bc(2,2,"EditOpportunityPage_VehicleType")),N.xb(2),N.gc("ngForOf",t.vehicleType)}}function _(t,e){if(1&t&&N.Jb(0,"app-item-err",9),2&t){const t=N.Zb(2);N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.vehType)("messages",t.formErrorMessages.vehType)}}function j(t,e){if(1&t&&(N.Nb(0,"ion-select-option",13),N.xc(1),N.Mb()),2&t){const t=e.$implicit;N.gc("value",t),N.xb(1),N.zc(" ",t.Name,"")}}function k(t,e){if(1&t&&(N.Nb(0,"ion-select-option",13),N.xc(1),N.Mb()),2&t){const t=e.$implicit;N.gc("value",t),N.xb(1),N.zc(" ",t,"")}}function A(t,e){if(1&t&&(N.Nb(0,"ion-select-option",13),N.xc(1),N.Mb()),2&t){const t=e.$implicit;N.gc("value",t.value),N.xb(1),N.zc(" ",t.label,"")}}function R(t,e){if(1&t&&(N.Nb(0,"ion-item"),N.Jb(1,"ion-datetime",26),N.ac(2,"translate"),N.Mb()),2&t){const t=N.Zb(2);N.xb(1),N.hc("placeholder",N.bc(2,3,"OpportunityDetails_PPDDate")),N.gc("min",t.ppDateMin)("max",t.ppDateMax)}}function T(t,e){if(1&t){const t=N.Ob();N.Nb(0,"ion-row",14),N.Nb(1,"ion-col",15),N.Nb(2,"ion-grid",16),N.Nb(3,"ion-row",16),N.Nb(4,"ion-col",17),N.vc(5,S,4,4,"ion-item",18),N.vc(6,_,1,2,"app-item-err",19),N.Mb(),N.Mb(),N.Nb(7,"ion-row",16),N.Nb(8,"ion-col",17),N.Nb(9,"ion-item"),N.Nb(10,"ion-select",20),N.Vb("ionChange",function(e){return N.qc(t),N.Zb().changeCmpgSource(e)}),N.ac(11,"translate"),N.vc(12,j,2,2,"ion-select-option",11),N.Mb(),N.Mb(),N.Jb(13,"app-item-err",9),N.Mb(),N.Mb(),N.Nb(14,"ion-row",16),N.Nb(15,"ion-col",17),N.Nb(16,"ion-item"),N.Nb(17,"ion-select",21),N.ac(18,"translate"),N.vc(19,k,2,2,"ion-select-option",11),N.Mb(),N.Mb(),N.Jb(20,"app-item-err",9),N.Mb(),N.Mb(),N.Nb(21,"ion-row",16),N.Nb(22,"ion-col",17),N.Nb(23,"ion-item"),N.Nb(24,"ion-select",22),N.ac(25,"translate"),N.vc(26,A,2,2,"ion-select-option",11),N.Mb(),N.Mb(),N.Jb(27,"app-item-err",9),N.Mb(),N.Mb(),N.Nb(28,"ion-row",16),N.Nb(29,"ion-col",17),N.vc(30,R,3,5,"ion-item",18),N.Jb(31,"app-item-err",9),N.Mb(),N.Mb(),N.Nb(32,"ion-row",16),N.Nb(33,"ion-col",17),N.Nb(34,"ion-item",23),N.Nb(35,"ion-input",24),N.Vb("ionFocus",function(){return N.qc(t),N.Zb().showModelInterestComp()}),N.Mb(),N.Mb(),N.Jb(36,"app-item-err",9),N.Mb(),N.Mb(),N.Mb(),N.Mb(),N.Mb()}if(2&t){const t=N.Zb();N.xb(5),N.gc("ngIf","my"===t.countryCode),N.xb(1),N.gc("ngIf","my"===t.countryCode),N.xb(4),N.hc("placeholder",N.bc(11,20,"OpportunityDetails_Source")),N.gc("compareWith",t.compareId),N.xb(2),N.gc("ngForOf",t.cmpgList),N.xb(1),N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.source)("messages",t.formErrorMessages.source),N.xb(4),N.hc("placeholder",N.bc(18,22,"OpportunityDetails_Channel")),N.xb(2),N.gc("ngForOf",t.chnlList),N.xb(1),N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.channel)("messages",t.formErrorMessages.channel),N.xb(4),N.hc("placeholder",N.bc(25,24,"OpportunityDetails_PPDRange")),N.xb(2),N.gc("ngForOf",t.ppDateRange),N.xb(1),N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.PPDRange)("messages",t.formErrorMessages.PPDRange),N.xb(3),N.gc("ngIf",t.oppForm.get("PPDRange").value==t.customPPDate),N.xb(1),N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.PPD)("messages",t.formErrorMessages.PPD),N.xb(5),N.gc("control",null==t.oppForm.controls?null:t.oppForm.controls.modelInterest)("messages",t.formErrorMessages.modelInterest)}}let J=(()=>{class t{constructor(t,e,o,n,i,r,s,a,p,l,b,m){this.formBuilder=t,this.route=e,this.translate=o,this.router=n,this.opportunitySrvc=i,this.loadingCtrl=r,this.navCtrl=s,this.contactService=a,this.errorSrvc=p,this.modalController=l,this.auth=b,this.alertCtrl=m,this.subs=new c.a,this.companyList=this.opportunitySrvc.getCompanyList(),this.vehicleType=this.opportunitySrvc.getVehicleType(),this.countryCode=y.a.countryCode,this.customPPDate=v.a.PP_DATE_CUSTOM,this.auth.subUser().subscribe(t=>{this.user=t})}ngOnInit(){this.oppForm=this.initOppForm(),this.subs.add(this.parseURL())}parseURL(){return this.contact=new u.a,this.route.paramMap.subscribe(t=>{const e=t.get(d.a.PARAM_ID);e===d.a.PARAM_ID?this.translate.get("EditOpportunityPage_NewOpportunity").subscribe(t=>{this.pageTitle=t}):this.translate.get("EditOpportunityPage_EditOpportunity").subscribe(t=>{this.pageTitle=t}),this.router.getCurrentNavigation().extras.state&&(this.states=this.router.getCurrentNavigation().extras.state,this.opportunity=this.states[d.a.STATE_OPP],this.opportunity.Id=e===d.a.PARAM_ID?null:e,this.getDetails(this.opportunity.ContactId))})}ionViewDidEnter(){console.log("ionViewDidEnter"),this.setUIBackButtonAction()}setUIBackButtonAction(){this.states[d.a.PAGE_HISTORY]&&"new_contact"===this.states[d.a.PAGE_HISTORY]&&(this.backButton.onClick=()=>{this.router.navigate([C.a.BASE+"/"+this.opportunity.ContactId])})}initOppForm(){const t=this.formBuilder.group({id:[""],name:[{value:"",disabled:!0}],company:["",[i.l.required]],source:["",[i.l.required]],channel:[[],[i.l.required]],vehType:["",[i.l.required]],modelInterest:[[],[i.l.required]],PPDRange:[""],PPD:[""],warmth:[0],notes:[""]});return this.initErrorMessages(t),t}initErrorMessages(t){this.translate.get("Error_CannotBeEmpty").subscribe(e=>{if(this.formErrorMessages={group:{}},t)for(const o of Object.keys(t.controls))switch(o){case"company":case"source":case"vehType":case"modelInterest":this.formErrorMessages[o]={required:e}}})}showModelInterestComp(){this.oppForm.get("company").value&&Object(p.a)(this.modalController.create({component:f.a,componentProps:{cmp:this.oppForm.get("company").value,team:"",selectedValues:this.oppForm.get("modelInterest").value}})).subscribe(t=>{Object(p.a)(t.onDidDismiss()).subscribe(t=>{if(t&&t.data){const e=t.data.map(t=>t.label);JSON.stringify(this.oppForm.get("modelInterest").value)!==JSON.stringify(e)&&(this.oppForm.get("modelInterest").setValue(e),this.oppForm.markAsDirty())}}),t.present()})}getDetails(t){this.translate.get("Common_Loading").pipe(Object(b.b)(t=>Object(p.a)(this.loadingCtrl.create({message:t}))),Object(b.b)(e=>(e.present(),Object(l.a)([this.contactService.getContactById(t).pipe(Object(m.a)(t=>{this.contact=t,this.oppForm.get("name").setValue(this.opportunity.ContactName)}))]).pipe(Object(m.a)(t=>{e.dismiss()},t=>{e.dismiss(),this.errorSrvc.presentServerErr(t)}))))).subscribe()}loadCompanyDependentApi(){if(!this.oppForm.get("company").value)return!1;const t=this.oppForm.get("company").value;this.translate.get("Common_Loading").pipe(Object(b.b)(t=>Object(p.a)(this.loadingCtrl.create({message:t}))),Object(b.b)(e=>(e.present(),Object(l.a)([this.checkForExistingOpp(t),this.getPPRange(t),this.getCmpgList(t)]).pipe(Object(m.a)(t=>{e.dismiss()},t=>{e.dismiss(),this.errorSrvc.presentServerErr(t)}))))).subscribe()}getPPRange(t){return this.opportunitySrvc.getPPDateRange(t).pipe(Object(m.a)(t=>{this.ppDateRange=t;const e=new h.a;e.label=this.customPPDate,e.value=this.customPPDate,this.ppDateRange.push(e);const o=new Date;o.setMonth(0),o.setDate(1),this.ppDateMin=o.toJSON();const n=new Date(o.getFullYear()+1,11,31);this.ppDateMax=n.toJSON()}))}getCmpgList(t){return this.opportunitySrvc.getCmpgList(t).pipe(Object(m.a)(t=>{this.cmpgList=t}))}changeCmpgSource(t){this.oppForm.get("source")&&this.oppForm.get("source").value instanceof M.a?(this.chnlList=this.oppForm.get("source").value.Channel,this.chnlList.indexOf(this.oppForm.get("channel").value)<0&&this.oppForm.get("channel").reset([]),this.oppForm.get("channel").disabled&&this.oppForm.get("channel").enable()):this.oppForm.get("channel").disable()}compareId(t,e){return t&&e?t.Id===e.Id:t===e}checkForExistingOpp(t){return this.opportunitySrvc.checkExistingOpportunity(this.opportunity.ContactId,t,this.user.userId).pipe(Object(m.a)(t=>{(null==t?void 0:t.length)>0&&this.genAlert(t)}))}genAlert(t){return Object(a.a)(this,void 0,void 0,function*(){(yield this.alertCtrl.create({header:"Duplicate Opportunity",message:"<p>You have an open opportunity with the same customer,</p><p><Strong>'Use Existing'</Strong> to go to the existing opportunity,</p><p><Strong>'Create New'</Strong> to generate another new opportunity.</p>",backdropDismiss:!1,buttons:[{text:"Create New",role:"cancel",handler:()=>{console.log("Create New clicked")}},{text:"Use Existing",handler:()=>{this.navCtrl.back(),setTimeout(e=>{this.navCtrl.navigateForward(g.a.BASE+"/"+t[0].Id)},1e3)}}]})).present()})}done(){this.opportunity.ContactName=this.oppForm.get("name").value,this.opportunity.Cmpg=this.oppForm.get("source").value,this.opportunity.Channel=this.oppForm.get("channel").value,this.opportunity.ModelInterest=this.oppForm.get("modelInterest").value,this.opportunity.Company=this.oppForm.get("company").value,this.opportunity.PlannedPurchaseDateRange=this.oppForm.get("PPDRange").value,this.opportunity.PlannedPurchasedDate=this.oppForm.get("PPD").value,this.opportunity.Type="Vehicle Sales",this.translate.get("Common_Saving").pipe(Object(b.b)(t=>Object(p.a)(this.loadingCtrl.create({message:t}))),Object(b.b)(t=>(t.present(),this.opportunitySrvc.upsertOpp(this.opportunity).pipe(Object(m.a)(e=>{this.opportunity=e,t.dismiss()},e=>{t.dismiss()}))))).subscribe(t=>{this.navCtrl.back(),setTimeout(t=>{this.navCtrl.navigateForward(g.a.BASE+"/"+this.opportunity.Id)},1e3)})}}return t.\u0275fac=function(e){return new(e||t)(N.Ib(i.a),N.Ib(s.a),N.Ib(P.d),N.Ib(s.g),N.Ib(F.a),N.Ib(r.mb),N.Ib(r.ob),N.Ib(O.a),N.Ib(x.a),N.Ib(r.nb),N.Ib(D.a),N.Ib(r.b))},t.\u0275cmp=N.Cb({type:t,selectors:[["app-edit-opportunity"]],viewQuery:function(t,e){if(1&t&&N.Bc(r.g,!0),2&t){let t;N.oc(t=N.Wb())&&(e.backButton=t.first)}},decls:30,vars:20,consts:[["color","primary","mode","ios"],["slot","start"],["defaultHref","",3,"text"],["slot","end"],[3,"click"],[3,"formGroup"],[1,"ion-no-margin","ion-no-padding"],["size","12",1,"ion-no-margin","ion-no-padding"],["formControlName","name",3,"placeholder"],[3,"control","messages"],["formControlName","company",3,"placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["class","ion-margin-top",4,"ngIf"],[3,"value"],[1,"ion-margin-top"],["size","12",1,"ion-margin-bottom","ion-margin-top"],[1,"ion-no-padding","ion-no-margin"],["size","12",1,"ion-no-padding","ion-no-margin"],[4,"ngIf"],[3,"control","messages",4,"ngIf"],["interface","action-sheet","formControlName","source",3,"compareWith","placeholder","ionChange"],["multiple","true","formControlName","channel",3,"placeholder"],["interface","action-sheet","formControlName","PPDRange",3,"placeholder"],["lines","none"],["formControlName","modelInterest","placeholder","Model Interest",1,"w100",3,"ionFocus"],["formControlName","vehType",3,"placeholder"],["displayFormat","DD MMM YYYY","formControlName","PPD",3,"min","max","placeholder"]],template:function(t,e){1&t&&(N.Nb(0,"ion-header"),N.Nb(1,"ion-toolbar",0),N.Nb(2,"ion-buttons",1),N.Jb(3,"ion-back-button",2),N.ac(4,"translate"),N.Mb(),N.Nb(5,"ion-buttons",3),N.Nb(6,"ion-button",4),N.Vb("click",function(){return e.done()}),N.xc(7),N.ac(8,"translate"),N.Mb(),N.Mb(),N.Nb(9,"ion-title"),N.xc(10),N.Mb(),N.Mb(),N.Mb(),N.Nb(11,"ion-content"),N.Nb(12,"form",5),N.Nb(13,"ion-grid",6),N.Nb(14,"ion-row",6),N.Nb(15,"ion-col",7),N.Nb(16,"ion-item"),N.Jb(17,"ion-input",8),N.ac(18,"translate"),N.Mb(),N.Jb(19,"app-item-err",9),N.Mb(),N.Mb(),N.Nb(20,"ion-row",6),N.Nb(21,"ion-col",7),N.Nb(22,"ion-item"),N.Nb(23,"ion-select",10),N.Vb("ionChange",function(){return e.loadCompanyDependentApi()}),N.ac(24,"translate"),N.vc(25,w,2,2,"ion-select-option",11),N.Mb(),N.Mb(),N.Jb(26,"app-item-err",9),N.Mb(),N.Mb(),N.vc(27,T,37,26,"ion-row",12),N.Nb(28,"ion-row"),N.Jb(29,"ion-col"),N.Mb(),N.Mb(),N.Mb(),N.Mb()),2&t&&(N.xb(3),N.hc("text",N.bc(4,12,"Common_Back")),N.xb(4),N.yc(N.bc(8,14,"Common_Done")),N.xb(3),N.yc(e.pageTitle),N.xb(2),N.gc("formGroup",e.oppForm),N.xb(5),N.hc("placeholder",N.bc(18,16,"EditOpportunityPage_Name")),N.xb(2),N.gc("control",null==e.oppForm.controls?null:e.oppForm.controls.name)("messages",e.formErrorMessages.name),N.xb(4),N.hc("placeholder",N.bc(24,18,"EditOpportunityPage_Company")),N.xb(2),N.gc("ngForOf",e.companyList),N.xb(1),N.gc("control",null==e.oppForm.controls?null:e.oppForm.controls.company)("messages",e.formErrorMessages.company),N.xb(1),N.gc("ngIf",e.oppForm.get("company").value))},directives:[r.w,r.ib,r.i,r.f,r.g,r.h,r.hb,r.q,i.m,i.i,i.d,r.v,r.T,r.p,r.B,r.A,r.tb,i.h,i.c,I.a,r.X,r.sb,n.l,n.m,r.Y,r.r],pipes:[P.c],styles:[".w100[_ngcontent-%COMP%]{width:100%}ion-content[_ngcontent-%COMP%]{--background:var(--ion-color-content-color)}div[_ngcontent-%COMP%]{background:#fff}ion-select[_ngcontent-%COMP%]{width:100%}"]}),t})();const B=[{path:":"+o("YgLt").a.PARAM_ID,children:[{path:"",component:J,pathMatch:"full"}]}];let L=(()=>{class t{}return t.\u0275mod=N.Gb({type:t}),t.\u0275inj=N.Fb({factory:function(e){return new(e||t)},imports:[[s.i.forChild(B)],s.i]}),t})();var V=o("CJCG"),Y=o("Rc/z");let z=(()=>{class t{}return t.\u0275mod=N.Gb({type:t}),t.\u0275inj=N.Fb({factory:function(e){return new(e||t)},imports:[[n.c,i.e,r.kb,i.k,P.b,V.a,Y.a,L]]}),t})()}}]);
//# sourceMappingURL=27.3fe73a8e42ccf985d624.js.map