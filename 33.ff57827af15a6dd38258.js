(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{KSZZ:function(t,e,a){"use strict";a.r(e),a.d(e,"EditEventPageModule",function(){return E});var n=a("ofXK"),s=a("3Pt+"),o=a("TEn/"),r=a("tyNb"),i=a("quSY"),l=a("Cfvw"),c=a("cp0P"),b=a("5+tZ"),m=a("vkgz"),h=a("rrCD"),d=a("vscJ"),g=a("xcqc"),u=a("gxNc"),v=a("fXoL"),p=a("sYmb"),N=a("oYSm"),D=a("FpxV"),M=a("gE7l");const F=[{path:":"+u.a.PARAM_ID,children:[{path:"",component:(()=>{class t{constructor(t,e,a,n,s,o,r,l,c){this.route=t,this.translate=e,this.eventSrvc=a,this.formBuilder=n,this.navCtrl=s,this.router=o,this.loadingCtrl=r,this.modalCtrl=l,this.contactSrvc=c,this.subs=new i.a,this.maxdate=new Date((new Date).setFullYear((new Date).getFullYear()+5)).getFullYear(),this.mindate=new Date((new Date).setFullYear((new Date).getFullYear()-5)).getFullYear(),this.alert=this.eventSrvc.getAlertTypes()}ngOnInit(){this.eventForm=this.initEventForm(),this.subs.add(this.parseURL())}parseURL(){return this.event=new g.a,this.route.paramMap.subscribe(t=>{this.event.Id=t.get(u.a.PARAM_ID),this.event.Id===u.a.NEW?this.translate.get("TasksPage_NewEvent").subscribe(t=>{this.pageTitle=t,this.event.Id=null}):this.translate.get("TasksPage_EditEvent").subscribe(t=>{this.pageTitle=t,this.getData()}),this.router.getCurrentNavigation().extras.state&&(this.states=this.router.getCurrentNavigation().extras.state,this.event.OpportunityId=this.states[u.a.STATE_OPPID])})}initEventForm(){const t=this.formBuilder.group({id:[""],taskName:["",[s.l.required]],contact:["",[s.l.required]],startDate:["",[s.l.required]],endDate:["",[s.l.required]],allDay:[!1,[s.l.required]],alert:[""],notes:[""]});return this.initErrorMessages(t),t}initErrorMessages(t){this.translate.get("Error_CannotBeEmpty").subscribe(e=>{if(this.formErrorMessages={group:{}},t)for(const a of Object.keys(t.controls))switch(a){case"taskName":case"contact":case"startDate":case"endDate":case"allDay":this.formErrorMessages[a]={required:e}}})}getData(){this.translate.get("Common_Loading").pipe(Object(b.b)(t=>Object(l.a)(this.loadingCtrl.create({message:t}))),Object(b.b)(t=>(t.present(),Object(c.a)([this.eventSrvc.getEventById(this.event.Id).pipe(Object(m.a)(t=>{this.event=t,this.setValues()}))]).pipe(Object(m.a)(e=>{t.dismiss()},e=>{t.dismiss()}))))).subscribe()}setValues(){this.eventForm.get("id").setValue(this.event.Id),this.eventForm.get("taskName").setValue(this.event.TaskName),this.eventForm.get("contact").setValue(this.event.ContactName),this.eventForm.get("startDate").setValue(this.event.StartDate),this.eventForm.get("allDay").setValue(this.event.AllDay),this.eventForm.get("endDate").setValue(this.event.EndDate),this.eventForm.get("alert").setValue(this.event.Alert),this.eventForm.get("notes").setValue(this.event.Notes)}getEndDate(){return this.event.StartDate?new Date(this.event.StartDate).toISOString():this.mindate}done(){this.event.TaskName=this.eventForm.get("taskName").value,this.event.ContactName=this.eventForm.get("contact").value,this.event.StartDate=this.eventForm.get("startDate").value,this.event.AllDay=this.eventForm.get("allDay").value,this.event.EndDate=this.eventForm.get("endDate").value,this.event.Alert=this.eventForm.get("alert").value,this.event.Notes=this.eventForm.get("notes").value,console.log(this.event.Id),this.translate.get("Common_Saving").pipe(Object(b.b)(t=>Object(l.a)(this.loadingCtrl.create({message:t}))),Object(b.b)(t=>(t.present(),this.eventSrvc.upsertEvent(this.event).pipe(Object(m.a)(e=>{t.dismiss()},e=>{t.dismiss()}))))).subscribe(t=>{this.navCtrl.back()})}selectContact(){Object(l.a)(this.modalCtrl.create({component:h.a,componentProps:{callbackFn:t=>this.contactSrvc.searchByName(t),transformFn:t=>new d.a({Title:t.Name,Label:`(${t.MobileNo})`,Note:t.Id}),noResultFn:t=>{},backdropDismiss:!1}})).subscribe(t=>{Object(l.a)(t.onDidDismiss()).subscribe(t=>{t&&t.data&&(this.event.ContactId=t.data.PersonContactId,this.event.ContactName=t.data.Name,this.eventForm.get("contact").setValue(t.data.Name))}),t.present()})}}return t.\u0275fac=function(e){return new(e||t)(v.Ib(r.a),v.Ib(p.d),v.Ib(N.a),v.Ib(s.a),v.Ib(o.ob),v.Ib(r.g),v.Ib(o.mb),v.Ib(o.nb),v.Ib(D.a))},t.\u0275cmp=v.Cb({type:t,selectors:[["app-edit-event"]],decls:49,vars:43,consts:[["color","primary","mode","ios"],["slot","start"],["defaultHref","",3,"text"],["slot","end"],[3,"disabled","click"],[3,"formGroup"],["formControlName","taskName",3,"placeholder"],[3,"control","messages"],["formControlName","contact",3,"placeholder","click"],[1,"ion-no-margin","ion-no-padding"],["size","12"],["lines","none"],["formControlName","startDate","displayFormat","DD MMM YYYY HH:mm",3,"placeholder","min","max"],["size","6"],["slot","end","formControlName","allDay"],["formControlName","endDate","displayFormat","DD MMM YYYY HH:mm",3,"placeholder","min","max"],[1,"ion-margin-top"],["rows","6","formControlName","notes",3,"placeholder"]],template:function(t,e){1&t&&(v.Nb(0,"ion-header"),v.Nb(1,"ion-toolbar",0),v.Nb(2,"ion-buttons",1),v.Jb(3,"ion-back-button",2),v.ac(4,"translate"),v.Mb(),v.Nb(5,"ion-buttons",3),v.Nb(6,"ion-button",4),v.Vb("click",function(){return e.done()}),v.xc(7),v.ac(8,"translate"),v.Mb(),v.Mb(),v.Nb(9,"ion-title"),v.xc(10),v.Mb(),v.Mb(),v.Mb(),v.Nb(11,"ion-content"),v.Nb(12,"form",5),v.Nb(13,"ion-item"),v.Jb(14,"ion-input",6),v.ac(15,"translate"),v.Mb(),v.Jb(16,"app-item-err",7),v.Nb(17,"ion-item"),v.Nb(18,"ion-input",8),v.Vb("click",function(){return e.selectContact()}),v.ac(19,"translate"),v.Mb(),v.Mb(),v.Jb(20,"app-item-err",7),v.Nb(21,"ion-grid",9),v.Nb(22,"ion-row"),v.Nb(23,"ion-col",10),v.Nb(24,"ion-item",11),v.Jb(25,"ion-datetime",12),v.ac(26,"translate"),v.Mb(),v.Mb(),v.Mb(),v.Nb(27,"ion-row"),v.Nb(28,"ion-col",13),v.Jb(29,"app-item-err",7),v.Mb(),v.Mb(),v.Mb(),v.Nb(30,"ion-item"),v.Nb(31,"ion-label"),v.xc(32),v.ac(33,"translate"),v.Mb(),v.Jb(34,"ion-checkbox",14),v.Mb(),v.Jb(35,"app-item-err",7),v.Nb(36,"ion-grid",9),v.Nb(37,"ion-row"),v.Nb(38,"ion-col",10),v.Nb(39,"ion-item",11),v.Jb(40,"ion-datetime",15),v.ac(41,"translate"),v.Mb(),v.Mb(),v.Mb(),v.Nb(42,"ion-row"),v.Nb(43,"ion-col",13),v.Jb(44,"app-item-err",7),v.Mb(),v.Mb(),v.Mb(),v.Nb(45,"ion-item",16),v.Jb(46,"ion-textarea",17),v.ac(47,"translate"),v.Mb(),v.Jb(48,"app-item-err",7),v.Mb(),v.Mb()),2&t&&(v.xb(3),v.hc("text",v.bc(4,27,"Common_Back")),v.xb(3),v.gc("disabled",e.eventForm.invalid),v.xb(1),v.yc(v.bc(8,29,"Common_Done")),v.xb(3),v.yc(e.pageTitle),v.xb(2),v.gc("formGroup",e.eventForm),v.xb(2),v.hc("placeholder",v.bc(15,31,"TasksPage_EditEvent")),v.xb(2),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.taskName)("messages",e.formErrorMessages.taskName),v.xb(2),v.hc("placeholder",v.bc(19,33,"EditTaskPage_Contacts")),v.xb(2),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.contact)("messages",e.formErrorMessages.contact),v.xb(5),v.hc("placeholder",v.bc(26,35,"EditTaskPage_StartDate")),v.hc("min",e.mindate),v.hc("max",e.maxdate),v.xb(4),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.startDate)("messages",e.formErrorMessages.startDate),v.xb(3),v.yc(v.bc(33,37,"EditTaskPage_AllDay")),v.xb(3),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.allDay)("messages",e.formErrorMessages.allDay),v.xb(5),v.hc("placeholder",v.bc(41,39,"EditTaskPage_EndDate")),v.hc("min",e.getEndDate()),v.hc("max",e.maxdate),v.xb(4),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.endDate)("messages",e.formErrorMessages.endDate),v.xb(2),v.hc("placeholder",v.bc(47,41,"EditTaskPage_Notes")),v.xb(2),v.gc("control",null==e.eventForm.controls?null:e.eventForm.controls.notes)("messages",e.formErrorMessages.notes))},directives:[o.w,o.ib,o.i,o.f,o.g,o.h,o.hb,o.q,s.m,s.i,s.d,o.B,o.A,o.tb,s.h,s.c,M.a,o.v,o.T,o.p,o.r,o.sb,o.H,o.o,o.c,o.gb],pipes:[p.c],styles:["ion-content[_ngcontent-%COMP%]{--background:var(--ion-color-content-color)}form[_ngcontent-%COMP%]{background:#fff}ion-select[_ngcontent-%COMP%]{width:100%}.no-opacity[_ngcontent-%COMP%]{opacity:1!important}ion-datetime[_ngcontent-%COMP%]{width:100%;border-bottom:1px solid #aaa}"]}),t})(),pathMatch:"full"}]}];let f=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[r.i.forChild(F)],r.i]}),t})();var C=a("Xdcg"),x=a("CJCG");let E=(()=>{class t{}return t.\u0275mod=v.Gb({type:t}),t.\u0275inj=v.Fb({factory:function(e){return new(e||t)},imports:[[n.c,s.e,o.kb,s.k,p.b,x.a,C.a,f]]}),t})()}}]);
//# sourceMappingURL=33.ff57827af15a6dd38258.js.map