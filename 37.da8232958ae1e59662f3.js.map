{"version":3,"sources":["./src/app/pages/tradein/edit-tradein/tradein-profile/components/tradein-form-my/tradein-form-my.component.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/components/tradein-form-my/tradein-form-my.component.html","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.page.html","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile-routing.module.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.page.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.module.ts"],"names":["TradeinFormMyComponent","translate","tdChange","this","addToForm","changes","tradein","Chassis","form","get","value","RegDate","YearMake","Make","Model","Variant","Color","TradeInSource","ExpectedPrice","Overtrade","Warranty","emit","addControl","required","updateFormMsg","subscribe","lang","messages","chassis","make","model","tradeInSource","routes","path","PARAM_ID","children","component","TradeinProfilePage","formBuilder","navCtrl","loadingCtrl","tradeinSrvc","route","oppSrvc","modalCtrl","subs","Subscription","countryCode","environment","tradeinForm","initTradeInForm","add","parseURL","opp","paramMap","params","console","log","OpportunityId","ContactId","CONTACT_ID","getData","pipe","mergeMap","from","create","message","loading","present","forkJoin","getOpportunityById","tap","e","dismiss","err","componentProps","callbackFn","searchStr","getPurchasers","transformFn","purchaser","Title","Name","noResultFn","backdropDismiss","modal","onDidDismiss","modalData","data","Purchaser","Id","Company","setValue","group","id","regNo","mileage","remarks","initErrorMessages","formErrorMessages","key","Object","keys","controls","td","RegNo","Mileage","Notes","upsertTradeIn","back","setTimeout","_","navigateForward","BASE","done","selectPurchaser","pathMatch","TradeinProfilePageRoutingModule","forChild","TradeinProfilePageModule"],"mappings":"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","file":"37.da8232958ae1e59662f3.js","sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter, OnChanges, SimpleChange } from '@angular/core';\r\nimport { TradeIn } from 'src/app/models/common/tradein.model';\r\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\r\nimport { FormErrorMessages } from 'src/app/models/common/form-error.model';\r\nimport { TranslateService } from '@ngx-translate/core';\r\n\r\n@Component({\r\n  selector: 'app-tradein-form-my',\r\n  templateUrl: './tradein-form-my.component.html',\r\n  styleUrls: ['./tradein-form-my.component.scss'],\r\n})\r\nexport class TradeinFormMyComponent implements OnInit, OnChanges {\r\n  @Input() form: FormGroup;\r\n  @Input() messages: FormErrorMessages;\r\n  @Input() tradein: TradeIn;\r\n  @Output() tdChange = new EventEmitter<TradeIn>();\r\n\r\n  constructor(private translate: TranslateService) {}\r\n\r\n  ngOnInit() {\r\n    this.addToForm();\r\n  }\r\n\r\n  ngOnChanges(changes: { [propKey: string]: SimpleChange }) {}\r\n\r\n  emit() {\r\n    this.tradein.Chassis = this.form.get('chassis').value;\r\n    this.tradein.RegDate = this.form.get('regDate').value;\r\n    this.tradein.YearMake = this.form.get('yearMake').value;\r\n    this.tradein.Make = this.form.get('make').value;\r\n    this.tradein.Model = this.form.get('model').value;\r\n    this.tradein.Variant = this.form.get('variant').value;\r\n    this.tradein.Color = this.form.get('color').value;\r\n    this.tradein.TradeInSource = this.form.get('tradeInSource').value;\r\n    this.tradein.ExpectedPrice = this.form.get('expectedPrice').value;\r\n    this.tradein.Overtrade = this.form.get('overtrade').value;\r\n    this.tradein.Warranty = this.form.get('warranty').value;\r\n    this.tdChange.emit(this.tradein);\r\n  }\r\n\r\n  private addToForm() {\r\n    if (!this.form) {\r\n      return;\r\n    }\r\n    this.form.addControl('chassis', new FormControl('', [Validators.required]));\r\n    this.form.addControl('regDate', new FormControl('', [Validators.required]));\r\n    this.form.addControl('yearMake', new FormControl(''));\r\n    this.form.addControl('make', new FormControl('', [Validators.required]));\r\n    this.form.addControl('model', new FormControl('', [Validators.required]));\r\n    this.form.addControl('variant', new FormControl(''));\r\n    this.form.addControl('color', new FormControl(''));\r\n    this.form.addControl('tradeInSource', new FormControl('', [Validators.required]));\r\n    this.form.addControl('expectedPrice', new FormControl(''));\r\n    this.form.addControl('overtrade', new FormControl(''));\r\n    this.form.addControl('warranty', new FormControl(''));\r\n    this.updateFormMsg();\r\n  }\r\n\r\n  private updateFormMsg() {\r\n    this.translate.get('Error_CannotBeEmpty').subscribe((lang) => {\r\n      this.messages.chassis = {\r\n        required: lang,\r\n      };\r\n      this.messages.make = {\r\n        required: lang,\r\n      };\r\n      this.messages.model = {\r\n        required: lang,\r\n      };\r\n      this.messages.tradeInSource = {\r\n        required: lang,\r\n      };\r\n    });\r\n  }\r\n}\r\n","<form [formGroup]=\"form\">\r\n  <ion-item>\r\n    <ion-input formControlName=\"chassis\" placeholder=\"{{ 'TradeInProfile_ChassisNo' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.chassis\" [messages]=\"messages.chassis\"></app-item-err>\r\n  <ion-item>\r\n    <ion-datetime displayFormat=\"MM/DD/YYYY\" formControlName=\"regDate\" placeholder=\"{{ 'TradeInProfile_RegistrationDate' | translate }}\"></ion-datetime>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.regDate\" [messages]=\"messages.regDate\"></app-item-err>\r\n  <ion-item>\r\n    <ion-datetime displayFormat=\"YYYY\" formControlName=\"yearMake\" placeholder=\"{{ 'TradeInProfile_YearMake' | translate }}\"></ion-datetime>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.yearMake\" [messages]=\"messages.yearMake\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"make\" placeholder=\"{{ 'TradeInProfile_Make' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.make\" [messages]=\"messages.make\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"model\" placeholder=\"{{ 'TradeInProfile_Model' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.model\" [messages]=\"messages.model\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"variant\" placeholder=\"{{ 'TradeInProfile_Variant' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.variant\" [messages]=\"messages.variant\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"color\" placeholder=\"{{ 'TradeInProfile_Color' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.color\" [messages]=\"messages.color\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"tradeInSource\" placeholder=\"{{ 'TradeInProfile_TradeInSource' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.tradeInSource\" [messages]=\"messages.tradeInSource\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"expectedPrice\" placeholder=\"{{ 'TradeInProfile_ExpectedPrice' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.expectedPrice\" [messages]=\"messages.expectedPrice\"></app-item-err>\r\n  <ion-item>\r\n    <ion-input formControlName=\"overtrade\" placeholder=\"{{ 'TradeInProfile_Overtrade' | translate }}\"></ion-input>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.overtrade\" [messages]=\"messages.overtrade\"></app-item-err>\r\n  <ion-item>\r\n    <ion-datetime displayFormat=\"YYYY\" formControlName=\"warranty\" placeholder=\"{{ 'TradeInProfile_WarrantyValidity' | translate }}\"></ion-datetime>\r\n  </ion-item>\r\n  <app-item-err [control]=\"form.controls?.warranty\" [messages]=\"messages.warranty\"></app-item-err>\r\n</form>\r\n","<ion-header>\r\n  <ion-toolbar color=\"primary\" mode=\"ios\">\r\n    <ion-buttons slot=\"start\">\r\n      <ion-back-button defaultHref=\"\" text=\"{{'Common_Cancel'|translate}}\"></ion-back-button>\r\n    </ion-buttons>\r\n    <ion-buttons slot=\"end\">\r\n      <ion-button (click)=\"done()\">{{'Common_Done'|translate}}</ion-button>\r\n    </ion-buttons>\r\n    <ion-title>{{'TradeInProfile_NewTradeIn'|translate}}</ion-title>\r\n  </ion-toolbar>\r\n</ion-header>\r\n<ion-content>\r\n  <form [formGroup]=\"tradeinForm\">\r\n    <ion-item>\r\n      <ion-input formControlName=\"regNo\" placeholder='{{\"TradeInProfile_RegistrationNo\"|translate}}'></ion-input>\r\n    </ion-item>\r\n    <app-item-err [control]=\"tradeinForm.controls?.regNo\" [messages]=\"formErrorMessages.regNo\"></app-item-err>\r\n    <ion-item>\r\n      <ion-input formControlName=\"purchaser\" placeholder='{{\"TradeInProfile_Purchaser\"|translate}}' (click)=\"selectPurchaser()\"></ion-input>\r\n    </ion-item>\r\n    <app-item-err [control]=\"tradeinForm.controls?.purchaser\" [messages]=\"formErrorMessages.purchaser\"></app-item-err>\r\n    <ion-item>\r\n      <ion-input formControlName=\"mileage\" placeholder='{{\"TradeInProfile_Mileage\"|translate}}'></ion-input>\r\n    </ion-item>\r\n    <app-item-err [control]=\"tradeinForm.controls?.mileage\" [messages]=\"formErrorMessages.mileage\"></app-item-err>\r\n    <app-tradein-form-my\r\n      [form]=\"tradeinForm\"\r\n      [tradein]=\"tradein\"\r\n      [messages]=\"formErrorMessages\"\r\n      (tdChange)=\"setTradein($event)\"\r\n      *ngIf=\"countryCode == 'my'\"\r\n    ></app-tradein-form-my>\r\n    <ion-item>\r\n      <ion-textarea rows=\"6\" formControlName=\"remarks\" placeholder='{{\"TradeInProfile_Notes\"|translate}}'></ion-textarea>\r\n    </ion-item>\r\n    <app-item-err [control]=\"tradeinForm.controls?.remarks\" [messages]=\"formErrorMessages.remarks\"></app-item-err>\r\n  </form>\r\n</ion-content>\r\n","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { TradeinProfilePage } from './tradein-profile.page';\r\nimport { TradeinProfilePageRoutingKeys } from './tradein-profile-routing.keys';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: `:${TradeinProfilePageRoutingKeys.PARAM_ID}/:contact`,\r\n    children: [\r\n      {\r\n        path: '',\r\n        component: TradeinProfilePage,\r\n        pathMatch: 'full',\r\n      },\r\n    ],\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class TradeinProfilePageRoutingModule {}\r\n","import { Component, OnInit } from '@angular/core';\r\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\r\nimport { FormErrorMessages } from 'src/app/models/common/form-error.model';\r\nimport { Subscription, from, forkJoin } from 'rxjs';\r\nimport { Purchaser, TradeIn } from 'src/app/models/common/tradein.model';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { environment } from 'src/environments/environment';\r\nimport { mergeMap, tap } from 'rxjs/operators';\r\nimport { TradeinViewProfilePageRoutingKeys } from '../../view-tradein/view-tradein-routing.keys';\r\nimport { NavController, LoadingController, ModalController } from '@ionic/angular';\r\nimport { CommonTradeinService } from 'src/app/services/common/tradein/tradein.service';\r\nimport { TradeinProfilePageRoutingKeys } from './tradein-profile-routing.keys';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport { Opportunity } from 'src/app/models/common/opportunity.model';\r\nimport { CommonOpportunityService } from 'src/app/services/common/opportunity/opportunity.service';\r\nimport { AutocompleteComponent } from 'src/app/components/common/autocomplete/autocomplete.component';\r\nimport { AutoCompleteModel } from 'src/app/models/common/auto-complete.model';\r\n\r\n@Component({\r\n  selector: 'app-tradein-profile',\r\n  templateUrl: './tradein-profile.page.html',\r\n  styleUrls: ['./tradein-profile.page.scss'],\r\n})\r\nexport class TradeinProfilePage implements OnInit {\r\n  private subs = new Subscription();\r\n  tradeinForm: FormGroup;\r\n  formErrorMessages: FormErrorMessages;\r\n  tradein: TradeIn;\r\n  countryCode = environment.countryCode;\r\n  opp: Opportunity;\r\n\r\n  constructor(\r\n    private formBuilder: FormBuilder,\r\n    private translate: TranslateService,\r\n    private navCtrl: NavController,\r\n    private loadingCtrl: LoadingController,\r\n    private tradeinSrvc: CommonTradeinService,\r\n    private route: ActivatedRoute,\r\n    private oppSrvc: CommonOpportunityService,\r\n    private modalCtrl: ModalController\r\n  ) {}\r\n\r\n  ngOnInit() {\r\n    this.tradeinForm = this.initTradeInForm();\r\n    this.subs.add(this.parseURL());\r\n  }\r\n\r\n  parseURL() {\r\n    this.tradein = new TradeIn();\r\n    this.opp = new Opportunity();\r\n    return this.route.paramMap.subscribe((params) => {\r\n      console.log(params);\r\n      this.tradein.OpportunityId = params.get(TradeinProfilePageRoutingKeys.PARAM_ID);\r\n      this.tradein.ContactId = params.get(TradeinProfilePageRoutingKeys.CONTACT_ID);\r\n      this.getData();\r\n    });\r\n  }\r\n\r\n  getData() {\r\n    this.translate\r\n      .get('Common_Loading')\r\n      .pipe(\r\n        mergeMap((lang) => {\r\n          return from(\r\n            this.loadingCtrl.create({\r\n              message: lang,\r\n            })\r\n          );\r\n        }),\r\n        mergeMap((loading) => {\r\n          loading.present();\r\n          return forkJoin([\r\n            this.oppSrvc.getOpportunityById(this.tradein.OpportunityId).pipe(\r\n              tap(\r\n                (e) => {\r\n                  this.opp = e;\r\n                  // this.tradein.ContactId = this.opp.ContactId;\r\n                  loading.dismiss();\r\n                },\r\n                (err) => {\r\n                  loading.dismiss();\r\n                }\r\n              )\r\n            ),\r\n          ]).pipe(\r\n            tap(\r\n              (e) => {\r\n                loading.dismiss();\r\n              },\r\n              (err) => {\r\n                loading.dismiss();\r\n              }\r\n            )\r\n          );\r\n        })\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  selectPurchaser() {\r\n    from(\r\n      this.modalCtrl.create({\r\n        component: AutocompleteComponent,\r\n        componentProps: {\r\n          callbackFn: (searchStr: string) => {\r\n            return this.tradeinSrvc.getPurchasers(searchStr);\r\n          },\r\n          transformFn: (purchaser: Purchaser) => {\r\n            return new AutoCompleteModel({\r\n              Title: purchaser.Name,\r\n            });\r\n          },\r\n          noResultFn: (searchStr: string) => {},\r\n          backdropDismiss: false,\r\n        },\r\n      })\r\n    ).subscribe((modal) => {\r\n      from(modal.onDidDismiss()).subscribe((modalData) => {\r\n        console.log(modalData);\r\n        if (modalData && modalData.data) {\r\n          this.tradein.Purchaser = modalData.data.Id;\r\n          this.tradein.Company = modalData.data.Company;\r\n          this.tradeinForm.get('purchaser').setValue(modalData.data.Name);\r\n        }\r\n      });\r\n      modal.present();\r\n    });\r\n  }\r\n\r\n  private initTradeInForm() {\r\n    const tradeinForm = this.formBuilder.group({\r\n      id: [''],\r\n      regNo: ['', [Validators.required]],\r\n      purchaser: ['', [Validators.required]],\r\n      mileage: ['', [Validators.required]],\r\n      remarks: [''],\r\n    });\r\n    this.initErrorMessages(tradeinForm);\r\n    return tradeinForm;\r\n  }\r\n\r\n  private initErrorMessages(form: FormGroup) {\r\n    this.translate.get('Error_CannotBeEmpty').subscribe((lang) => {\r\n      this.formErrorMessages = {\r\n        group: {},\r\n      };\r\n      if (!form) {\r\n        return;\r\n      }\r\n      for (const key of Object.keys(form.controls)) {\r\n        switch (key) {\r\n          case 'regNo':\r\n          case 'purchaser':\r\n          case 'mileage':\r\n            this.formErrorMessages[key] = {\r\n              required: lang,\r\n            };\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  setTradein(td: TradeIn) {\r\n    this.tradein = td;\r\n  }\r\n\r\n  done() {\r\n    this.tradein.RegNo = this.tradeinForm.get('regNo').value;\r\n    this.tradein.Mileage = this.tradeinForm.get('mileage').value;\r\n    this.tradein.Notes = this.tradeinForm.get('remarks').value;\r\n    this.translate\r\n      .get('Common_Saving')\r\n      .pipe(\r\n        mergeMap((lang) => {\r\n          return from(\r\n            this.loadingCtrl.create({\r\n              message: lang,\r\n            })\r\n          );\r\n        }),\r\n        mergeMap((loading) => {\r\n          loading.present();\r\n          return this.tradeinSrvc.upsertTradeIn(this.tradein).pipe(\r\n            tap(\r\n              (e) => {\r\n                this.tradein = e[0];\r\n                loading.dismiss();\r\n              },\r\n              (err) => {\r\n                loading.dismiss();\r\n              }\r\n            )\r\n          );\r\n        })\r\n      )\r\n      .subscribe((e) => {\r\n        this.navCtrl.back();\r\n        setTimeout((_) => {\r\n          this.navCtrl.navigateForward(TradeinViewProfilePageRoutingKeys.BASE + '/' + this.tradein.Id);\r\n        }, 1000);\r\n      });\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { TradeinProfilePageRoutingModule } from './tradein-profile-routing.module';\r\n\r\nimport { TradeinProfilePage } from './tradein-profile.page';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { ItemErrComponentModule } from 'src/app/components/common/item-err/item-err.module';\r\nimport { TradeinFormMyComponent } from './components/tradein-form-my/tradein-form-my.component';\r\n\r\n@NgModule({\r\n  imports: [CommonModule, FormsModule, IonicModule, ReactiveFormsModule, TranslateModule, ItemErrComponentModule, TradeinProfilePageRoutingModule],\r\n  declarations: [TradeinProfilePage, TradeinFormMyComponent],\r\n})\r\nexport class TradeinProfilePageModule {}\r\n"],"sourceRoot":"webpack:///"}