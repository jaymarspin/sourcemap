(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0alx":function(t,e,r){"use strict";var i=r("VKeD");e.isIterable=function(t){return t&&"function"==typeof t[i.iterator]}},"2KeD":function(t,e,r){"use strict";var i=r("Q1FS"),n=r("zB/H"),o=r("zfKp");e.scheduleObservable=function(t,e){return new i.Observable(function(r){var i=new n.Subscription;return i.add(e.schedule(function(){var n=t[o.observable]();i.add(n.subscribe({next:function(t){i.add(e.schedule(function(){return r.next(t)}))},error:function(t){i.add(e.schedule(function(){return r.error(t)}))},complete:function(){i.add(e.schedule(function(){return r.complete()}))}}))})),i})}},"2qMH":function(t,e,r){"use strict";var i=r("Q1FS"),n=r("zB/H");e.scheduleArray=function(t,e){return new i.Observable(function(r){var i=new n.Subscription,o=0;return i.add(e.schedule(function(){o!==t.length?(r.next(t[o++]),r.closed||i.add(this.schedule())):r.complete()})),i})}},"6qA3":function(t,e,r){"use strict";var i=r("OAkW"),n=r("Z5tI"),o=r("poJ0"),s=r("ozli"),c=r("yRPT"),a=r("90cg"),l=r("GMZp"),u=r("VKeD"),b=r("zfKp");e.subscribeTo=function(t){if(t&&"function"==typeof t[b.observable])return s.subscribeToObservable(t);if(c.isArrayLike(t))return i.subscribeToArray(t);if(a.isPromise(t))return n.subscribeToPromise(t);if(t&&"function"==typeof t[u.iterator])return o.subscribeToIterable(t);var e=l.isObject(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},"6rP4":function(t,e,r){"use strict";r.r(e),r.d(e,"ViewTestdrivePageModule",function(){return ft});var i=r("ofXK"),n=r("3Pt+"),o=r("TEn/"),s=r("tyNb"),c=r("quSY"),a=r("Cfvw"),l=r("cp0P"),u=r("lzGV"),b=r("VOuF"),h=r("UsUu"),d=r("UNqx"),p=r("vkgz"),f=r("lJxs"),g=r("5+tZ"),v=r("mrSG"),m=r("fXoL"),y=r("LRne"),x=r("D0XW"),_=r("mlxB"),w=r("7o/Q"),M=r("WMd4");class S{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new N(t,this.delay,this.scheduler))}}class N extends w.a{constructor(t,e,r){super(t),this.delay=e,this.scheduler=r,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,r=e.queue,i=t.scheduler,n=t.destination;for(;r.length>0&&r[0].time-i.now()<=0;)r.shift().notification.observe(n);if(r.length>0){const e=Math.max(0,r[0].time-i.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(N.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,r=new E(e.now()+this.delay,t);this.queue.push(r),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(M.a.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(M.a.createComplete()),this.unsubscribe()}}class E{constructor(t,e){this.time=t,this.notification=e}}var O=r("eIep"),P=r("/uUt"),T=r("wd/R");class k{constructor(){this.keyscanDT=T()}}var C=r("AytR"),I=r("BLr9"),D=r("7zc5"),j=r("RJfy");let V=(()=>{class t{constructor(t,e,r,i,n){this.qr=t,this.el=e,this.pop=r,this.err=i,this.orientation=n,this.scan=new m.o,this.subs=new c.a}ngOnInit(){try{this.lockScreenIfPopover()}catch(t){this.err.logError(t)}}ngAfterViewInit(){try{setTimeout(()=>this.showCamera(),400)}catch(t){this.err.logError(t)}}ngOnDestroy(){try{this.subs.unsubscribe(),this.qr.destroy()}catch(t){this.err.logError(t)}}showCamera(){try{const t=(C.a.emulator?Object(y.a)('{"chassis":"WBS2U720X07E37591","model":"a0x9000000HFmvV","regNum":"T/PLATE"}').pipe(Object(p.a)(t=>this.hideBackground()),function(t,e=x.a){const r=Object(_.a)(t)?+t-e.now():Math.abs(t);return t=>t.lift(new S(r,e))}(1e3)):Object(a.a)(this.qr.show()).pipe(Object(O.a)(t=>{if(t.showing)return this.hideBackground(),this.qr.scan();throw new Error("Error showing camera")}))).pipe(Object(P.a)(),Object(f.a)(e=>{const r=JSON.parse(e),i=Object.assign(new k,r);if(!i.model||!i.chassis)throw new Error("Invalid QR code");return t.unsubscribe(),this.showBackground(),this.qr.hide(),this.dismissPopover(i),i})).subscribe(()=>{},e=>(t.unsubscribe(),this.showBackground(),this.qr.hide(),this.dismissPopover(null),this.err.logError(e),this.err.presentServerErr(e)))}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}close(){try{Object(a.a)(this.qr.pausePreview()).pipe(Object(g.a)(t=>this.qr.hide())),this.showBackground(),this.dismissPopover(null)}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}reverseCamera(){try{Object(a.a)(this.qr.getStatus()).pipe(Object(g.a)(t=>t.scanning?this.qr.useCamera(0===t.currentCamera?1:0):Object(y.a)(null))).subscribe(t=>{},t=>(this.err.logError(t),this.err.presentServerErr(t)))}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}toggleLight(){try{Object(a.a)(this.qr.getStatus()).pipe(Object(g.a)(t=>t.scanning&&t.canEnableLight?t.lightEnabled?this.qr.disableLight():this.qr.enableLight():Object(y.a)(null))).subscribe(t=>{},t=>(this.err.logError(t),this.err.presentServerErr(t)))}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}dismissPopover(t){return Object(v.a)(this,void 0,void 0,function*(){const e=yield this.pop.getTop();e&&(yield e.dismiss(t),this.orientation.unlock())})}hideBackground(){document.querySelectorAll("ion-app > :not(ion-popover)").forEach(t=>{t.classList.add("blurBg")});const t=document.querySelector("ion-popover");if(t){this.origBg=t.style.getPropertyValue("--background"),t.style.setProperty("--background","transparent");const e=t.querySelector("ion-backdrop"),r=this.el.nativeElement.offsetParent,i=r.offsetTop,n=i+r.offsetHeight;this.backdropBg=e.style.background,this.backdropOpacity=e.style.opacity,e.style.background=`linear-gradient(to bottom, var(--ion-color-primary) 0, var(--ion-color-primary) ${i}px,transparent ${i}px, transparent ${n}px, var(--ion-color-primary) ${n}px, var(--ion-color-primary) 100vh) center/80vw 100vh no-repeat, linear-gradient(to bottom, var(--ion-color-primary) 0, var(--ion-color-primary) 100vh) left/10vw 100vh no-repeat, linear-gradient(to bottom, var(--ion-color-primary) 0, var(--ion-color-primary) 100vh) right/10vw 100vh no-repeat`,e.style.opacity="1"}}showBackground(){document.querySelectorAll("ion-app > :not(ion-popover)").forEach(t=>{t.classList.remove("blurBg")});const t=document.querySelector("ion-popover");if(t){this.origBg&&t.style.setProperty("--background",this.origBg);const e=t.querySelector("ion-backdrop");e&&(e.style.background=this.backdropBg,e.style.opacity=this.backdropOpacity)}}lockScreenIfPopover(){return Object(v.a)(this,void 0,void 0,function*(){(yield this.pop.getTop())&&this.orientation.lock(this.orientation.type)})}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(I.a),m.Ib(m.m),m.Ib(o.qb),m.Ib(D.a),m.Ib(j.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-key-scanner"]],outputs:{scan:"scan"},decls:12,vars:0,consts:[["no-padding",""],[1,"transparent","ion-align-items-start","ion-justify-content-end"],["size","3"],["size","small","color","light",3,"click"],["name","close"],[1,"transparent","ion-align-items-end","ion-justify-content-center"],["size","small","color","secondary",3,"click"],["name","flash"],["name","camera-reverse-outline"]],template:function(t,e){1&t&&(m.Nb(0,"ion-grid",0),m.Nb(1,"ion-row",1),m.Nb(2,"ion-col",2),m.Nb(3,"ion-fab-button",3),m.Vb("click",function(){return e.close()}),m.Jb(4,"ion-icon",4),m.Mb(),m.Mb(),m.Mb(),m.Nb(5,"ion-row",5),m.Nb(6,"ion-col",2),m.Nb(7,"ion-fab-button",6),m.Vb("click",function(){return e.toggleLight()}),m.Jb(8,"ion-icon",7),m.Mb(),m.Mb(),m.Nb(9,"ion-col",2),m.Nb(10,"ion-fab-button",6),m.Vb("click",function(){return e.reverseCamera()}),m.Jb(11,"ion-icon",8),m.Mb(),m.Mb(),m.Mb(),m.Mb())},directives:[o.v,o.T,o.p,o.t,o.x],styles:["ion-grid[_ngcontent-%COMP%]{--headerHeight:44px;--totalHeight:60vh;min-height:var(--totalHeight)}.transparent[_ngcontent-%COMP%]{background:transparent;background-clip:content-box}ion-row.transparent[_ngcontent-%COMP%]{height:calc(var(--totalHeight) / 2)}ion-row[justify-content-center][_ngcontent-%COMP%]{padding-bottom:1em}ion-row[justify-content-center][_ngcontent-%COMP%]   ion-fab-button[_ngcontent-%COMP%]{margin:auto}"]}),t})();var F=r("sYmb"),A=r("6GcI"),B=r("gE7l");let L=(()=>{class t{constructor(t,e,r,i,n,o,s){this.modalCtrl=t,this.alertCtrl=e,this.translate=r,this.formBuilder=i,this.popover=n,this.tdService=o,this.loadingCtrl=s}ngOnInit(){this.tdForm=this.initTdForm()}initTdForm(){const t=this.formBuilder.group({regNo:["",[n.l.required]],variantName:["",[n.l.required]],mileageStart:["",[n.l.required]]});return this.initErrorMessages(t),t}initErrorMessages(t){this.translate.get("Error_CannotBeEmpty").subscribe(e=>{if(this.formErrorMessages={group:{}},t)for(const r of Object.keys(t.controls))switch(r){case"regNo":case"variantName":case"mileageStart":this.formErrorMessages[r]={required:e}}})}apply(){this.translate.get("Common_Loading").pipe(Object(g.b)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(g.b)(t=>(t.present(),this.testdrive.Vehicle.MileageStart=this.tdForm.get("mileageStart").value,this.tdService.startTestdrive(this.testdrive).pipe(Object(p.a)(t=>{this.testdrive=t})).pipe(Object(p.a)(e=>{t.dismiss(),this.modalCtrl.dismiss(this.testdrive)},e=>{t.dismiss()}))))).subscribe()}cancel(){this.modalCtrl.dismiss()}qrScanner(){Object(a.a)(this.popover.create({component:V,showBackdrop:!0,cssClass:"full-popover",backdropDismiss:!1,animated:!1})).pipe(Object(p.a)(t=>t.present()),Object(g.b)(t=>t.onDidDismiss()),Object(f.a)(t=>{t&&t.data&&this.translate.get("Common_Loading").pipe(Object(g.b)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(g.b)(e=>(e.present(),this.tdService.getVehByRegNo(t.data.regNum).pipe(Object(p.a)(t=>{this.testdrive.Vehicle=t,this.tdForm.get("regNo").setValue(t.RegNum),this.tdForm.get("variantName").setValue(t.ShortDesc),this.tdForm.get("mileageStart").setValue(t.MileageStart),this.loadingCtrl.dismiss()}))))).subscribe()})).subscribe()}search(){const t=[];Object(a.a)(this.alertCtrl.create({backdropDismiss:!1,inputs:[{name:"regNo",type:"text"}]})).pipe(Object(g.b)(e=>Object(l.a)([this.translate.get("ViewTestdrivePage_EnterRegistrationNumber").pipe(Object(p.a)(t=>{e.header=t})),this.translate.get("Common_Cancel").pipe(Object(p.a)(e=>{t.push({text:e,role:"cancel",handler:()=>{}})})),this.translate.get("Common_Search").pipe(Object(p.a)(e=>{t.push({text:e,handler:t=>{this.translate.get("Common_Loading").pipe(Object(g.b)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(g.b)(e=>(e.present(),this.tdService.getVehByRegNo(t.regNo).pipe(Object(p.a)(t=>{this.testdrive.Vehicle=t,this.tdForm.get("regNo").setValue(t.RegNum),this.tdForm.get("variantName").setValue(t.ShortDesc),this.tdForm.get("mileageStart").setValue(t.MileageStart),this.loadingCtrl.dismiss()}))))).subscribe()}})}))]).pipe(Object(p.a)(()=>{e.buttons=t,e.present()})))).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(o.nb),m.Ib(o.b),m.Ib(F.d),m.Ib(n.a),m.Ib(o.qb),m.Ib(A.a),m.Ib(o.mb))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-scan-testdrive"]],inputs:{testdrive:"testdrive"},decls:42,vars:38,consts:[[1,"ion-no-border"],["color","primary","mode","ios"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"sub-header"],[1,"ion-padding"],[1,"ion-text-center","ion-margin-bottom"],["fill","outline","expand","block","color","primary",1,"ion-margin-bottom",3,"click"],[1,"ion-margin-top","ion-margin-bottom"],["fill","outline","expand","block","color","primary",1,"ion-margin-top",3,"click"],[1,"ion-margin-top"],[3,"formGroup"],["lines","none"],["formControlName","regNo",3,"disabled","placeholder"],[3,"control","messages"],["lines","none",1,"ion-margin-top"],["formControlName","variantName",3,"disabled","placeholder"],["formControlName","mileageStart",3,"placeholder"],["fill","solid","expand","block","color","primary",3,"disabled","click"]],template:function(t,e){1&t&&(m.Nb(0,"ion-header",0),m.Nb(1,"ion-toolbar",1),m.Nb(2,"ion-buttons",2),m.Nb(3,"ion-button",3),m.Vb("click",function(){return e.cancel()}),m.Jb(4,"ion-icon",4),m.Mb(),m.Mb(),m.Nb(5,"ion-title"),m.xc(6),m.ac(7,"translate"),m.Jb(8,"br"),m.Nb(9,"ion-text",5),m.xc(10),m.ac(11,"translate"),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Nb(12,"ion-content",6),m.Nb(13,"section",7),m.Nb(14,"ion-button",8),m.Vb("click",function(){return e.qrScanner()}),m.xc(15),m.ac(16,"translate"),m.Mb(),m.Nb(17,"ion-label",9),m.Nb(18,"b"),m.xc(19),m.ac(20,"translate"),m.Mb(),m.Mb(),m.Nb(21,"ion-button",10),m.Vb("click",function(){return e.search()}),m.xc(22),m.ac(23,"translate"),m.Mb(),m.Mb(),m.Nb(24,"section",11),m.Lb(25,12),m.Nb(26,"ion-item",13),m.Jb(27,"ion-input",14),m.ac(28,"translate"),m.Mb(),m.Jb(29,"app-item-err",15),m.Nb(30,"ion-item",16),m.Jb(31,"ion-input",17),m.ac(32,"translate"),m.Mb(),m.Jb(33,"app-item-err",15),m.Nb(34,"ion-item",16),m.Jb(35,"ion-input",18),m.ac(36,"translate"),m.Mb(),m.Jb(37,"app-item-err",15),m.Kb(),m.Mb(),m.Mb(),m.Nb(38,"ion-footer",6),m.Nb(39,"ion-button",19),m.Vb("click",function(){return e.apply()}),m.xc(40),m.ac(41,"translate"),m.Mb(),m.Mb()),2&t&&(m.xb(6),m.zc(" ",m.bc(7,20,"ViewTestdrivePage_Testdrive"),""),m.xb(4),m.Ac(" ",m.bc(11,22,"TestdrivePage_OpportunityID"),": ",null==e.testdrive?null:e.testdrive.OpportunityId," "),m.xb(5),m.zc(" ",m.bc(16,24,"ViewTestdrivePage_Scan")," "),m.xb(4),m.yc(m.bc(20,26,"ViewTestdrivePage_OR")),m.xb(3),m.zc(" ",m.bc(23,28,"ViewTestdrivePage_SearchRegistrationNo")," "),m.xb(3),m.gc("formGroup",e.tdForm),m.xb(2),m.hc("placeholder",m.bc(28,30,"ViewTestdrivePage_RegistrationNumber")),m.gc("disabled",!0),m.xb(2),m.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.regNo)("messages",e.formErrorMessages.regNo),m.xb(2),m.ic("placeholder"," ",m.bc(32,32,"ViewTestdrivePage_VariantName"),""),m.gc("disabled",!0),m.xb(2),m.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.variantName)("messages",e.formErrorMessages.variantName),m.xb(2),m.ic("placeholder"," ",m.bc(36,34,"ViewTestdrivePage_MileageStart"),""),m.xb(2),m.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.mileageStart)("messages",e.formErrorMessages.mileageStart),m.xb(2),m.gc("disabled",e.tdForm.invalid),m.xb(1),m.zc(" ",m.bc(41,36,"ViewTestdrivePage_Start")," "))},directives:[o.w,o.ib,o.i,o.h,o.x,o.hb,o.fb,o.q,o.H,n.i,n.d,o.B,o.A,o.tb,n.h,n.c,B.a,o.u],pipes:[F.c],styles:["ion-content[_ngcontent-%COMP%]{--background:var(--ion-color-content-color)}div[_ngcontent-%COMP%]{background:#fff}.sub-header[_ngcontent-%COMP%]{font-size:12px}ion-footer[_ngcontent-%COMP%]{background:var(--ion-color-content-color)}ion-item[_ngcontent-%COMP%]{--background:rgba(118,118,128,0.12);border-radius:10px}"]}),t})();class q{constructor(t,e,r){this.x=t,this.y=e,this.time=r||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class z{constructor(t,e,r,i,n,o){this.startPoint=t,this.control2=e,this.control1=r,this.endPoint=i,this.startWidth=n,this.endWidth=o}static fromPoints(t,e){const r=this.calculateControlPoints(t[0],t[1],t[2]).c2,i=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new z(t[1],r,i,t[2],e.start,e.end)}static calculateControlPoints(t,e,r){const i=t.x-e.x,n=t.y-e.y,o=e.x-r.x,s=e.y-r.y,c=(t.x+e.x)/2,a=(t.y+e.y)/2,l=(e.x+r.x)/2,u=(e.y+r.y)/2,b=Math.sqrt(i*i+n*n),h=Math.sqrt(o*o+s*s),d=h/(b+h),p=e.x-(l+(c-l)*d),f=e.y-(u+(a-u)*d);return{c1:new q(c+p,a+f),c2:new q(l+p,u+f)}}length(){let t,e,r=0;for(let i=0;i<=10;i+=1){const n=i/10,o=this.point(n,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this.point(n,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(i>0){const i=o-t,n=s-e;r+=Math.sqrt(i*i+n*n)}t=o,e=s}return r}point(t,e,r,i,n){return e*(1-t)*(1-t)*(1-t)+3*r*(1-t)*(1-t)*t+3*i*(1-t)*t*t+n*t*t*t}}class R{constructor(t,e={}){this.canvas=t,this.options=e,this._handleMouseDown=t=>{1===t.which&&(this._mouseButtonDown=!0,this._strokeBegin(t))},this._handleMouseMove=t=>{this._mouseButtonDown&&this._strokeMoveUpdate(t)},this._handleMouseUp=t=>{1===t.which&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(t))},this._handleTouchStart=t=>{t.preventDefault(),1===t.targetTouches.length&&this._strokeBegin(t.changedTouches[0])},this._handleTouchMove=t=>{t.preventDefault(),this._strokeMoveUpdate(t.targetTouches[0])},this._handleTouchEnd=t=>{t.target===this.canvas&&(t.preventDefault(),this._strokeEnd(t.changedTouches[0]))},this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._strokeMoveUpdate=this.throttle?function(t,e=250){let r,i,n,o=0,s=null;const c=()=>{o=Date.now(),s=null,r=t.apply(i,n),s||(i=null,n=[])};return function(...a){const l=Date.now(),u=e-(l-o);return i=this,n=a,u<=0||u>e?(s&&(clearTimeout(s),s=null),o=l,r=t.apply(i,n),s||(i=null,n=[])):s||(s=window.setTimeout(c,u)),r}}(R.prototype._strokeUpdate,this.throttle):R.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(),this._isEmpty=!0}fromDataURL(t,e={},r){const i=new Image,n=e.ratio||window.devicePixelRatio||1,o=e.width||this.canvas.width/n,s=e.height||this.canvas.height/n;this._reset(),i.onload=()=>{this._ctx.drawImage(i,0,0,o,s),r&&r()},i.onerror=t=>{r&&r(t)},i.src=t,this._isEmpty=!1}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return this._toSVG();default:return this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",window.PointerEvent?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.removeEventListener("pointerdown",this._handleMouseDown),this.canvas.removeEventListener("pointermove",this._handleMouseMove),document.removeEventListener("pointerup",this._handleMouseUp),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t){this.clear(),this._fromData(t,({color:t,curve:e})=>this._drawCurve({color:t,curve:e}),({color:t,point:e})=>this._drawDot({color:t,point:e})),this._data=t}toData(){return this._data}_strokeBegin(t){const e={color:this.penColor,points:[]};"function"==typeof this.onBegin&&this.onBegin(t),this._data.push(e),this._reset(),this._strokeUpdate(t)}_strokeUpdate(t){if(0===this._data.length)return void this._strokeBegin(t);const e=this._createPoint(t.clientX,t.clientY),r=this._data[this._data.length-1],i=r.points,n=i.length>0&&i[i.length-1],o=!!n&&e.distanceTo(n)<=this.minDistance,s=r.color;if(!n||!n||!o){const t=this._addPoint(e);n?t&&this._drawCurve({color:s,curve:t}):this._drawDot({color:s,point:e}),i.push({time:e.time,x:e.x,y:e.y})}}_strokeEnd(t){this._strokeUpdate(t),"function"==typeof this.onEnd&&this.onEnd(t)}_handlePointerEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("pointerdown",this._handleMouseDown),this.canvas.addEventListener("pointermove",this._handleMouseMove),document.addEventListener("pointerup",this._handleMouseUp)}_handleMouseEvents(){this._mouseButtonDown=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor}_createPoint(t,e){const r=this.canvas.getBoundingClientRect();return new q(t-r.left,e-r.top,(new Date).getTime())}_addPoint(t){const{_lastPoints:e}=this;if(e.push(t),e.length>2){3===e.length&&e.unshift(e[0]);const t=this._calculateCurveWidths(e[1],e[2]),r=z.fromPoints(e,t);return e.shift(),r}return null}_calculateCurveWidths(t,e){const r=this.velocityFilterWeight*e.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(r),n={end:i,start:this._lastWidth};return this._lastVelocity=r,this._lastWidth=i,n}_strokeWidth(t){return Math.max(this.maxWidth/(t+1),this.minWidth)}_drawCurveSegment(t,e,r){const i=this._ctx;i.moveTo(t,e),i.arc(t,e,r,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve({color:t,curve:e}){const r=this._ctx,i=e.endWidth-e.startWidth,n=2*Math.floor(e.length());r.beginPath(),r.fillStyle=t;for(let o=0;o<n;o+=1){const t=o/n,r=t*t,s=r*t,c=1-t,a=c*c,l=a*c;let u=l*e.startPoint.x;u+=3*a*t*e.control1.x,u+=3*c*r*e.control2.x,u+=s*e.endPoint.x;let b=l*e.startPoint.y;b+=3*a*t*e.control1.y,b+=3*c*r*e.control2.y,b+=s*e.endPoint.y;const h=Math.min(e.startWidth+s*i,this.maxWidth);this._drawCurveSegment(u,b,h)}r.closePath(),r.fill()}_drawDot({color:t,point:e}){const r=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;r.beginPath(),this._drawCurveSegment(e.x,e.y,i),r.closePath(),r.fillStyle=t,r.fill()}_fromData(t,e,r){for(const i of t){const{color:t,points:n}=i;if(n.length>1)for(let r=0;r<n.length;r+=1){const i=n[r],o=new q(i.x,i.y,i.time);this.penColor=t,0===r&&this._reset();const s=this._addPoint(o);s&&e({color:t,curve:s})}else this._reset(),r({color:t,point:n[0]})}}_toSVG(){const t=this._data,e=Math.max(window.devicePixelRatio||1,1),r=this.canvas.width/e,i=this.canvas.height/e,n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("width",this.canvas.width.toString()),n.setAttribute("height",this.canvas.height.toString()),this._fromData(t,({color:t,curve:e})=>{const r=document.createElement("path");if(!(isNaN(e.control1.x)||isNaN(e.control1.y)||isNaN(e.control2.x)||isNaN(e.control2.y))){const i=`M ${e.startPoint.x.toFixed(3)},${e.startPoint.y.toFixed(3)} C ${e.control1.x.toFixed(3)},${e.control1.y.toFixed(3)} ${e.control2.x.toFixed(3)},${e.control2.y.toFixed(3)} ${e.endPoint.x.toFixed(3)},${e.endPoint.y.toFixed(3)}`;r.setAttribute("d",i),r.setAttribute("stroke-width",(2.25*e.endWidth).toFixed(3)),r.setAttribute("stroke",t),r.setAttribute("fill","none"),r.setAttribute("stroke-linecap","round"),n.appendChild(r)}},({color:t,point:e})=>{const r=document.createElement("circle"),i="function"==typeof this.dotSize?this.dotSize():this.dotSize;r.setAttribute("r",i.toString()),r.setAttribute("cx",e.x.toString()),r.setAttribute("cy",e.y.toString()),r.setAttribute("fill",t),n.appendChild(r)});const o=`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 ${r} ${i}" width="${r}" height="${i}">`;let s=n.innerHTML;if(void 0===s){const t=document.createElement("dummy"),e=n.childNodes;t.innerHTML="";for(let r=0;r<e.length;r+=1)t.appendChild(e[r].cloneNode(!0));s=t.innerHTML}return"data:image/svg+xml;base64,"+btoa(o+s+"</svg>")}}var W=R;function H(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-col",2),m.Nb(1,"ion-button",3),m.Vb("click",function(){return m.qc(t),m.Zb().clear()}),m.xc(2,"CLEAR"),m.Mb(),m.Mb()}}function U(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-col",2),m.Nb(1,"ion-button",4),m.Vb("click",function(){return m.qc(t),m.Zb().sign()}),m.xc(2,"CONFIRM "),m.Mb(),m.Mb()}}let J=(()=>{class t{constructor(t,e,r){this.el=t,this.pop=e,this.err=r,this.sigBlob=new m.o,this.sub=new c.a}ngOnInit(){try{this.sigTitle=this.sigTitle?this.sigTitle:"Signature"}catch(t){this.err.logError(t)}}ngOnDestroy(){try{this.sub.unsubscribe()}catch(t){this.err.logError(t)}}ngAfterViewInit(){try{this.signature=new W(this.el.nativeElement.querySelector("canvas"))}catch(t){this.err.logError(t)}}clear(){try{this.signature.clear()}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}sign(){try{const t=this.getSigBlob();this.sigBlob.emit(t),this.dismissPopover(t)}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}getSigBlob(){const t=this.signature.toDataURL();return this.convertBase64ToBlob(t.split(",")[1],"image/png")}dismissPopover(t){return Object(v.a)(this,void 0,void 0,function*(){const e=yield this.pop.getTop();e&&(yield e.dismiss(t))})}convertBase64ToBlob(t,e){const r=atob(t),i=new ArrayBuffer(r.length),n=new Uint8Array(i);for(let o=0;o<r.length;o++)n[o]=r.charCodeAt(o);return new Blob([i],{type:e})}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(m.m),m.Ib(o.qb),m.Ib(D.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-signature"]],inputs:{sigTitle:"sigTitle",showConfirm:"showConfirm",showClear:"showClear"},outputs:{sigBlob:"sigBlob"},decls:15,vars:3,consts:[["no-padding",""],["size","6",4,"ngIf"],["size","6"],["fill","solid","expand","block","color","light",3,"click"],["expand","block","fill","solid","color","secondary","strong","true",3,"click"]],template:function(t,e){1&t&&(m.Nb(0,"ion-grid",0),m.Nb(1,"ion-row"),m.Nb(2,"ion-col"),m.Nb(3,"ion-card"),m.Nb(4,"ion-card-header"),m.Nb(5,"ion-card-title"),m.xc(6),m.Mb(),m.Nb(7,"ion-card-subtitle"),m.xc(8,"Kindly sign within the box below"),m.Mb(),m.Mb(),m.Nb(9,"ion-card-content"),m.Jb(10,"canvas"),m.Mb(),m.Nb(11,"ion-grid"),m.Nb(12,"ion-row"),m.vc(13,H,3,0,"ion-col",1),m.vc(14,U,3,0,"ion-col",1),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb()),2&t&&(m.xb(6),m.yc(e.sigTitle),m.xb(7),m.gc("ngIf",e.showClear),m.xb(1),m.gc("ngIf",e.showConfirm))},directives:[o.v,o.T,o.p,o.j,o.l,o.n,o.m,o.k,i.m,o.h],styles:["canvas[_ngcontent-%COMP%]{width:100%;height:100%;background:var(--ion-color-light);border:.5px var(--ion-color-light-shade)}.ios[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;margin-bottom:10px}.ios[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{font-size:11px}"]}),t})();var G=r("cNlW");function Z(t,e){if(1&t&&(m.Nb(0,"div"),m.Nb(1,"ion-card"),m.Nb(2,"ion-card-header"),m.Nb(3,"ion-card-subtitle"),m.xc(4,"PDPA"),m.Mb(),m.Mb(),m.Nb(5,"ion-card-content"),m.Jb(6,"div",6),m.Mb(),m.Mb(),m.Mb()),2&t){const t=m.Zb(2);m.xb(6),m.gc("innerHTML",t.pdpaTerms,m.rc)}}function $(t,e){if(1&t&&(m.Nb(0,"div",5),m.Nb(1,"div"),m.Nb(2,"ion-card"),m.Nb(3,"ion-card-header"),m.Nb(4,"ion-card-subtitle"),m.xc(5,"Test Drive T&C"),m.Mb(),m.Mb(),m.Nb(6,"ion-card-content"),m.Jb(7,"div",6),m.Mb(),m.Mb(),m.Mb(),m.vc(8,Z,7,1,"div",4),m.Mb()),2&t){const t=m.Zb();m.xb(7),m.gc("innerHTML",t.tdTerms,m.rc),m.xb(1),m.gc("ngIf",t.needsPDPA)}}function K(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-grid"),m.Nb(1,"ion-row"),m.Nb(2,"ion-col"),m.Nb(3,"app-signature",7),m.Vb("sigBlob",function(e){return m.qc(t),m.Zb().saveSignature(e)}),m.Mb(),m.Mb(),m.Mb(),m.Mb()}2&t&&(m.xb(3),m.gc("showClear",!0))}function Q(t,e){if(1&t&&(m.Nb(0,"ion-row"),m.Nb(1,"ion-col"),m.Nb(2,"form",8),m.Nb(3,"ion-grid",9),m.Nb(4,"ion-row"),m.Nb(5,"ion-col",10),m.Jb(6,"ion-checkbox",11),m.Mb(),m.Nb(7,"ion-col",12),m.Nb(8,"ion-label"),m.xc(9),m.Mb(),m.Mb(),m.Mb(),m.Nb(10,"ion-row"),m.Nb(11,"ion-col",10),m.Jb(12,"ion-checkbox",13),m.Mb(),m.Nb(13,"ion-col",12),m.Nb(14,"ion-label"),m.xc(15),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb()),2&t){const t=m.Zb();m.xb(2),m.gc("formGroup",t.pdpaForm),m.xb(7),m.yc(t.dataConsent),m.xb(6),m.yc(t.marketingConsent)}}function Y(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-col"),m.Nb(1,"ion-button",14),m.Vb("click",function(){return m.qc(t),m.Zb().cancelSign()}),m.xc(2,"Cancel"),m.Mb(),m.Mb()}if(2&t){const t=m.Zb();m.xb(1),m.gc("disabled",t.isSaving)}}function X(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-button",17),m.Vb("click",function(){m.qc(t);const e=m.Zb(2);return null==e.sigElem?null:e.sigElem.sign()}),m.xc(1,"Confirm"),m.Mb()}}function tt(t,e){1&t&&(m.Nb(0,"ion-button",18),m.Jb(1,"ion-spinner"),m.Mb())}function et(t,e){if(1&t&&(m.Nb(0,"ion-col"),m.vc(1,X,2,0,"ion-button",15),m.vc(2,tt,2,0,"ion-button",16),m.Mb()),2&t){const t=m.Zb();m.xb(1),m.gc("ngIf",!t.isSaving),m.xb(1),m.gc("ngIf",t.isSaving)}}function rt(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-col"),m.Nb(1,"ion-button",19),m.Vb("click",function(){return m.qc(t),m.Zb().sign()}),m.xc(2,"Sign"),m.Mb(),m.Mb()}}let it=(()=>{class t{constructor(t,e,r,i,n,o){this.fb=t,this.tdService=e,this.popover=r,this.pdfSign=i,this.modal=n,this.err=o,this.isSaving=!1;try{this.pdpaForm=this.fb.group({dataConsent:[!1],marketingConsent:[!1]})}catch(o){this.err.logError(o)}}ngOnInit(){this.needsPDPA&&this.pdpaForm.controls.dataConsent.setValidators([n.l.requiredTrue])}saveSignature(t){if(!t)return;this.isSaving=!0;const e=this.needsPDPA?740:690;this.getPDFBlob().pipe(Object(g.b)(r=>(console.log(r),this.pdfSign.signPDF(90,e,0,200,40,r,t))),Object(g.b)(t=>(console.log(t),this.tdService.saveSignedPDF(this.td,t,!this.needsPDPA||this.pdpaForm.get("dataConsent").value,!this.needsPDPA||this.pdpaForm.get("marketingConsent").value)))).subscribe(t=>{this.td=t,this.isSaving=!1,this.modal.dismiss(t)})}sign(){try{if(!this.pdpaForm.valid)return void Object.values(this.pdpaForm.controls).forEach(t=>{t.markAsTouched({onlySelf:!0})});this.showSign=!0}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}cancelSign(){try{this.showSign=!1}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}cancel(){try{this.modal.dismiss()}catch(t){this.err.logError(t),this.err.presentServerErr(t)}}getPDFBlob(){return this.tdService.getBlankTDPDF(this.td,!this.needsPDPA||this.pdpaForm.get("marketingConsent").value,!this.needsPDPA||this.pdpaForm.get("dataConsent").value)}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(n.a),m.Ib(A.a),m.Ib(o.qb),m.Ib(G.a),m.Ib(o.nb),m.Ib(D.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-test-drive-indemnity"]],viewQuery:function(t,e){if(1&t&&m.Bc(J,!0),2&t){let t;m.oc(t=m.Wb())&&(e.sigElem=t.first)}},decls:19,vars:6,consts:[["slot","end"],[3,"click"],["slot","fixed"],["class","vertical-grow",4,"ngIf"],[4,"ngIf"],[1,"vertical-grow"],[1,"termsWrapper",3,"innerHTML"],["sigTitle","Test Drive Signature",3,"showClear","sigBlob"],[3,"formGroup"],["no-padding",""],["size","1"],["formControlName","dataConsent",1,"resetLineHeight"],["size","11"],["formControlName","marketingConsent",1,"resetLineHeight"],["type","button","expand","block","fill","solid","color","light",3,"disabled","click"],["type","button","expand","block","strong","true","fill","solid","color","secondary",3,"click",4,"ngIf"],["type","button","expand","block","strong","true","fill","solid","color","secondary","disabled","",4,"ngIf"],["type","button","expand","block","strong","true","fill","solid","color","secondary",3,"click"],["type","button","expand","block","strong","true","fill","solid","color","secondary","disabled",""],["type","button","expand","block","fill","solid","color","secondary",3,"click"]],template:function(t,e){1&t&&(m.Nb(0,"ion-header"),m.Nb(1,"ion-toolbar"),m.Nb(2,"ion-title"),m.xc(3,"Terms and Conditions"),m.Mb(),m.Nb(4,"ion-buttons",0),m.Nb(5,"ion-button",1),m.Vb("click",function(){return e.cancel()}),m.Nb(6,"ion-text"),m.xc(7,"Cancel"),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Nb(8,"ion-content",2),m.vc(9,$,9,2,"div",3),m.vc(10,K,4,1,"ion-grid",4),m.Mb(),m.Nb(11,"ion-footer"),m.Nb(12,"ion-toolbar"),m.Nb(13,"ion-grid"),m.vc(14,Q,16,3,"ion-row",4),m.Nb(15,"ion-row"),m.vc(16,Y,3,1,"ion-col",4),m.vc(17,et,3,2,"ion-col",4),m.vc(18,rt,3,0,"ion-col",4),m.Mb(),m.Mb(),m.Mb(),m.Mb()),2&t&&(m.xb(9),m.gc("ngIf",!e.showSign),m.xb(1),m.gc("ngIf",e.showSign),m.xb(4),m.gc("ngIf",!e.showSign&&e.needsPDPA),m.xb(2),m.gc("ngIf",e.showSign),m.xb(1),m.gc("ngIf",e.showSign),m.xb(1),m.gc("ngIf",!e.showSign))},directives:[o.w,o.ib,o.hb,o.i,o.h,o.fb,o.q,i.m,o.u,o.v,o.T,o.j,o.l,o.m,o.k,o.p,J,n.m,n.i,n.d,o.o,o.c,n.h,n.c,o.H,o.bb],styles:["ion-checkbox.ion-invalid.ion-touched[_ngcontent-%COMP%]{border:2px solid var(--ion-color-danger)!important}"]}),t})();var nt=r("te5A");function ot(t,e){if(1&t&&(m.Nb(0,"section",9),m.Nb(1,"ion-text"),m.Nb(2,"b"),m.xc(3),m.ac(4,"translate"),m.Mb(),m.Mb(),m.Nb(5,"div",9),m.Lb(6,18),m.Nb(7,"ion-grid",10),m.Nb(8,"ion-row"),m.Nb(9,"ion-col",11),m.xc(10),m.ac(11,"translate"),m.Mb(),m.Nb(12,"ion-col",19),m.Nb(13,"ion-text",20),m.xc(14),m.Mb(),m.Mb(),m.Mb(),m.Nb(15,"ion-row"),m.Nb(16,"ion-col",11),m.xc(17),m.ac(18,"translate"),m.Mb(),m.Nb(19,"ion-col",19),m.Nb(20,"ion-text",20),m.xc(21),m.Mb(),m.Mb(),m.Mb(),m.Nb(22,"ion-row"),m.Nb(23,"ion-col",11),m.xc(24),m.ac(25,"translate"),m.Mb(),m.Nb(26,"ion-col",11),m.Nb(27,"ion-text",20),m.xc(28),m.ac(29,"date"),m.Mb(),m.Mb(),m.Mb(),m.Nb(30,"ion-row",21),m.Nb(31,"ion-col",11),m.xc(32),m.ac(33,"translate"),m.Mb(),m.Nb(34,"ion-col",11),m.Nb(35,"ion-text",20),m.xc(36),m.Mb(),m.Mb(),m.Mb(),m.Nb(37,"ion-row",21),m.Nb(38,"ion-col",11),m.xc(39),m.ac(40,"translate"),m.Mb(),m.Nb(41,"ion-col",11),m.Nb(42,"ion-text",20),m.xc(43),m.Mb(),m.Mb(),m.Mb(),m.Nb(44,"ion-row",21),m.Nb(45,"ion-col",11),m.xc(46),m.ac(47,"translate"),m.Mb(),m.Nb(48,"ion-col",11),m.Nb(49,"ion-text",20),m.xc(50),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Kb(),m.Mb(),m.Mb()),2&t){const t=m.Zb();m.xb(3),m.yc(m.bc(4,14,"ViewTestdrivePage_VehicleDetails")),m.xb(3),m.gc("formGroup",t.tdForm),m.xb(4),m.zc(" ",m.bc(11,16,"ViewTestdrivePage_VariantName")," "),m.xb(4),m.zc(" ",null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.Name," "),m.xb(3),m.zc(" ",m.bc(18,18,"ViewTestdrivePage_Chassis")," "),m.xb(4),m.zc(" ",null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.Chassis," "),m.xb(3),m.zc(" ",m.bc(25,20,"ViewTestdrivePage_StartTime")," "),m.xb(4),m.zc(" ",m.cc(29,22,null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.StartTime,"hh:mm a")," "),m.xb(4),m.zc(" ",m.bc(33,25,"ViewTestdrivePage_MileageStart")," "),m.xb(4),m.yc(null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.MileageStart),m.xb(3),m.zc(" ",m.bc(40,27,"ViewTestdrivePage_MileageEnd")," "),m.xb(4),m.yc(null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.MileageEnd),m.xb(3),m.zc(" ",m.bc(47,29,"ViewTestdrivePage_Notes")," "),m.xb(4),m.yc(null==t.testdrive||null==t.testdrive.Vehicle?null:t.testdrive.Vehicle.Notes)}}function st(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-button",24),m.Vb("click",function(){return m.qc(t),m.Zb(2).scan()}),m.Nb(1,"ion-label"),m.xc(2),m.ac(3,"translate"),m.Mb(),m.Mb()}if(2&t){const t=m.Zb(2);m.gc("disabled",!t.testdrive.IsSigned),m.xb(2),m.zc(" ",m.bc(3,2,"ViewTestdrivePage_Next")," ")}}function ct(t,e){if(1&t){const t=m.Ob();m.Nb(0,"ion-button",25),m.Vb("click",function(){return m.qc(t),m.Zb(2).endTd()}),m.Nb(1,"ion-label"),m.xc(2),m.ac(3,"translate"),m.Mb(),m.Mb()}2&t&&(m.xb(2),m.zc(" ",m.bc(3,1,"ViewTestdrivePage_End")," "))}function at(t,e){if(1&t&&(m.Nb(0,"ion-footer",6),m.vc(1,st,4,4,"ion-button",22),m.vc(2,ct,4,3,"ion-button",23),m.Mb()),2&t){const t=m.Zb();m.xb(1),m.gc("ngIf","SCHEDULED"==t.testdrive.Status),m.xb(1),m.gc("ngIf","VEHICLE OUT"==t.testdrive.Status)}}const lt=[{path:":"+b.a.PARAM_ID,children:[{path:"",component:(()=>{class t{constructor(t,e,r,i,n,o,s,a,l,u,b,h){this.route=t,this.router=e,this.testdriveSrvc=r,this.translate=i,this.loadingCtrl=n,this.modalCtrl=o,this.formBuilder=s,this.navCtrl=a,this.opener=l,this.alertCtrl=u,this.toastCtrl=b,this.errorSrvc=h,this.subs=new c.a}ngOnInit(){this.tdForm=this.initTdForm(),this.subs.add(this.parseURL()),console.log(this.testdrive)}initTdForm(){const t=this.formBuilder.group({mileageEnd:[""],notes:[""]});return this.initErrorMessages(t),t}initErrorMessages(t){this.translate.get("Error_CannotBeEmpty").subscribe(e=>{if(this.formErrorMessages={group:{}},t)for(const r of Object.keys(t.controls));})}parseURL(){return this.testdrive=new u.a,this.route.paramMap.subscribe(t=>{this.testdrive.Id=t.get(b.a.PARAM_ID),this.getData(this.testdrive.Id)})}dismiss(){this.navCtrl.back()}getData(t){this.translate.get("Common_Loading").pipe(Object(d.mergeMap)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(d.mergeMap)(e=>(e.present(),this.testdriveSrvc.getTestdrivesById(t).pipe(Object(p.a)(t=>{this.testdrive=t,this.updateForm()})).pipe(Object(p.a)(t=>{e.dismiss()},t=>{e.dismiss()}))))).subscribe()}updateForm(){var t,e;this.tdForm.get("mileageEnd").setValue(null===(t=this.testdrive.Vehicle)||void 0===t?void 0:t.MileageEnd),this.tdForm.get("notes").setValue(null===(e=this.testdrive.Vehicle)||void 0===e?void 0:e.Notes)}editTestdrive(){this.router.navigate([`${h.a.BASE}/${this.testdrive.Id}`])}signTD(){this.translate.get("Common_Loading").pipe(Object(d.mergeMap)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(d.mergeMap)(t=>(t.present(),this.testdriveSrvc.getTNCTerms(this.testdrive).pipe(Object(d.mergeMap)((t,e)=>(console.log(t),this.modalCtrl.create({component:it,componentProps:{td:this.testdrive,marketingConsent:t.marketingConsent,dataConsent:t.dataConsent,pdpaTerms:t.pdpaTerms,tdTerms:t.tdTerms,needsPDPA:t.needsPDPA}}))),Object(d.mergeMap)(e=>(t.dismiss(),e.present(),e.onDidDismiss())))))).subscribe(t=>{t.data&&(console.log(t),this.testdrive=Object.assign(new u.a,t.data))})}printTD(){return this.testdriveSrvc.getSignedTDPDF(this.testdrive).pipe(Object(f.a)(t=>this.opener.open(t.toURL(),"application/pdf"))).subscribe()}scan(){Object(a.a)(this.modalCtrl.create({component:L,backdropDismiss:!1,animated:!0,cssClass:"full-screen",componentProps:{testdrive:this.testdrive?Object.assign({},this.testdrive):null}})).subscribe(t=>{Object(a.a)(t.onDidDismiss()).subscribe(t=>{t&&t.data&&(this.testdrive=t.data)}),t.present()})}endTd(){const t=[];Object(a.a)(this.alertCtrl.create({backdropDismiss:!1,inputs:[{placeholder:"End Mileage",name:"endMileage",type:"text"},{placeholder:"Customer Comments",name:"remarks",type:"text"}]})).pipe(Object(d.mergeMap)(e=>Object(l.a)([this.translate.get("ViewTestdrivePage_EndTD").pipe(Object(p.a)(t=>{e.header=t})),this.translate.get("Common_Cancel").pipe(Object(p.a)(e=>{t.push({text:e,role:"cancel",handler:()=>{}})})),this.translate.get("ViewTestdrivePage_End").pipe(Object(p.a)(e=>{t.push({text:e,handler:t=>t.endMileage?this.testdrive.Vehicle.MileageStart>=t.endMileage?(this.errorSrvc.presentServerErr(`Mileage must be higher than starting mileage (${this.testdrive.Vehicle.MileageStart})`),!1):void this.translate.get("Common_Loading").pipe(Object(d.mergeMap)(t=>Object(a.a)(this.loadingCtrl.create({message:t}))),Object(d.mergeMap)(e=>(e.present(),this.testdrive.Vehicle.MileageEnd=t.endMileage,this.testdrive.Vehicle.Notes=t.remarks,this.testdriveSrvc.endTestdrive(this.testdrive).pipe(Object(p.a)(t=>{this.testdrive=t})).pipe(Object(p.a)(t=>{e.dismiss()},t=>(this.testdrive.Vehicle.MileageEnd="",this.testdrive.Vehicle.Notes="",e.dismiss(),console.log(t),this.errorSrvc.presentServerErr(t),!1)))))).subscribe():(this.errorSrvc.presentServerErr("Please key in the mileage"),!1)})}))]).pipe(Object(p.a)(()=>{e.buttons=t,e.present()})))).subscribe()}showFooter(){var t,e;return"completed"!==(null===(e=null===(t=this.testdrive)||void 0===t?void 0:t.Vehicle)||void 0===e?void 0:e.Status.toLocaleLowerCase())}disableNextButton(){var t;return!(!this.testdrive||!(null===(t=this.testdrive)||void 0===t?void 0:t.Vehicle))&&this.tdForm.invalid}}return t.\u0275fac=function(e){return new(e||t)(m.Ib(s.a),m.Ib(s.g),m.Ib(A.a),m.Ib(F.d),m.Ib(o.mb),m.Ib(o.nb),m.Ib(n.a),m.Ib(o.ob),m.Ib(nt.a),m.Ib(o.b),m.Ib(o.ub),m.Ib(D.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["app-view-testdrive"]],decls:68,vars:43,consts:[[1,"ion-no-border"],["color","primary","mode","ios"],["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"sub-header"],[1,"ion-padding"],[1,"ion-text-center"],[1,"sub-title"],[1,"ion-margin-top"],[1,"ion-no-margin"],["size","6",1,"ion-text-start"],["class","ion-margin-top",4,"ngIf"],[1,"ion-no-margin","ion-no-padding"],["button","","detail","",3,"click"],[1,"ion-text-end"],["color","primary",1,"done-icon",3,"name"],["class","ion-padding",4,"ngIf"],[3,"formGroup"],["size","6","color","primary",1,"ion-text-start"],["color","primary"],[1,"ion-align-items-center"],["fill","outline","expand","block","color","primary",3,"disabled","click",4,"ngIf"],["fill","outline","expand","block","color","primary",3,"click",4,"ngIf"],["fill","outline","expand","block","color","primary",3,"disabled","click"],["fill","outline","expand","block","color","primary",3,"click"]],template:function(t,e){1&t&&(m.Nb(0,"ion-header",0),m.Nb(1,"ion-toolbar",1),m.Nb(2,"ion-buttons",2),m.Nb(3,"ion-button",3),m.Vb("click",function(){return e.dismiss()}),m.Jb(4,"ion-icon",4),m.Mb(),m.Mb(),m.Nb(5,"ion-title"),m.xc(6),m.ac(7,"translate"),m.Jb(8,"br"),m.Nb(9,"ion-text",5),m.xc(10),m.ac(11,"translate"),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Nb(12,"ion-content",6),m.Nb(13,"section",7),m.Nb(14,"h2"),m.xc(15),m.Mb(),m.Nb(16,"ion-text",8),m.xc(17),m.Mb(),m.Mb(),m.Nb(18,"section",9),m.Nb(19,"ion-text"),m.Nb(20,"b"),m.xc(21),m.ac(22,"translate"),m.Mb(),m.Mb(),m.Nb(23,"div",9),m.Nb(24,"ion-grid",10),m.Nb(25,"ion-row"),m.Nb(26,"ion-col",11),m.xc(27),m.ac(28,"translate"),m.Mb(),m.Nb(29,"ion-col",11),m.xc(30),m.Mb(),m.Mb(),m.Nb(31,"ion-row"),m.Nb(32,"ion-col",11),m.xc(33),m.ac(34,"translate"),m.Mb(),m.Nb(35,"ion-col",11),m.xc(36),m.Mb(),m.Mb(),m.Nb(37,"ion-row"),m.Nb(38,"ion-col",11),m.xc(39),m.ac(40,"translate"),m.Mb(),m.Nb(41,"ion-col",11),m.xc(42),m.ac(43,"date"),m.Mb(),m.Mb(),m.Nb(44,"ion-row"),m.Nb(45,"ion-col",11),m.xc(46),m.ac(47,"translate"),m.Mb(),m.Nb(48,"ion-col",11),m.xc(49),m.ac(50,"date"),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.vc(51,ot,51,31,"section",12),m.Nb(52,"section",9),m.Nb(53,"ion-text"),m.Nb(54,"b"),m.xc(55),m.ac(56,"translate"),m.Mb(),m.Mb(),m.Nb(57,"div",9),m.Nb(58,"ion-grid",13),m.Nb(59,"ion-row"),m.Nb(60,"ion-col"),m.Nb(61,"ion-item",14),m.Vb("click",function(){return e.testdrive.IsSigned?e.printTD():e.signTD()}),m.Nb(62,"ion-label"),m.xc(63),m.ac(64,"translate"),m.Mb(),m.Nb(65,"ion-label",15),m.Jb(66,"ion-icon",16),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.vc(67,at,3,2,"ion-footer",17)),2&t&&(m.xb(6),m.zc(" ",m.bc(7,19,"ViewTestdrivePage_Testdrive"),""),m.xb(4),m.Ac(" ",m.bc(11,21,"TestdrivePage_OpportunityID"),": ",null==e.testdrive?null:e.testdrive.OpportunityId," "),m.xb(5),m.yc(null==e.testdrive?null:e.testdrive.ContactName),m.xb(2),m.yc(null==e.testdrive?null:e.testdrive.SourceName),m.xb(4),m.yc(m.bc(22,23,"ViewTestdrivePage_ContactDetails")),m.xb(6),m.zc(" ",m.bc(28,25,"ViewTestdrivePage_IDNumber")," "),m.xb(3),m.zc(" ",null==e.testdrive?null:e.testdrive.DocNum," "),m.xb(3),m.zc(" ",m.bc(34,27,"ViewTestdrivePage_DrivingLicense")," "),m.xb(3),m.zc(" ",null==e.testdrive?null:e.testdrive.DrivingLicense," "),m.xb(3),m.zc(" ",m.bc(40,29,"ViewTestdrivePage_ExpiryDate")," "),m.xb(3),m.zc(" ",m.cc(43,31,null==e.testdrive?null:e.testdrive.ExpiryDate,"dd MMM y")," "),m.xb(4),m.zc(" ",m.bc(47,34,"ViewTestdrivePage_PlannedStartDate")," "),m.xb(3),m.zc(" ",m.cc(50,36,null==e.testdrive?null:e.testdrive.PlannedStartDate,"dd MMM y h:mm a")," "),m.xb(2),m.gc("ngIf",null==e.testdrive?null:e.testdrive.Vehicle),m.xb(4),m.yc(m.bc(56,39,"ViewTestdrivePage_AdditionalDetails")),m.xb(8),m.zc(" ",m.bc(64,41,"ViewTestdrivePage_IndemnityForm")," "),m.xb(3),m.gc("name",e.testdrive.IsSigned?"checkmark-circle":"ellipse-outline"),m.xb(1),m.gc("ngIf",e.showFooter()))},directives:[o.w,o.ib,o.i,o.h,o.x,o.hb,o.fb,o.q,o.v,o.T,o.p,i.m,o.B,o.H,n.i,n.d,o.u],pipes:[F.c,i.f],styles:[".sub-header[_ngcontent-%COMP%]{font-size:12px}ion-content[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%]{--background:var(--ion-color-content-color)}ion-footer[_ngcontent-%COMP%]{background:var(--ion-color-content-color)}div[_ngcontent-%COMP%]{background:#fff}.sub-title[_ngcontent-%COMP%]{color:#90a4ae}.done-icon[_ngcontent-%COMP%]{font-size:24px;vertical-align:middle}"]}),t})(),pathMatch:"full"}]}];let ut=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[s.i.forChild(lt)],s.i]}),t})();var bt=r("CJCG");let ht=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[i.c,o.kb,F.b]]}),t})(),dt=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[i.c,o.kb,n.k,n.e,ht]]}),t})(),pt=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[i.c,o.kb]]}),t})(),ft=(()=>{class t{}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[i.c,n.e,n.k,F.b,o.kb,F.b,ut,bt.a,dt,pt]]}),t})()},"90cg":function(t,e,r){"use strict";e.isPromise=function(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},"9AGB":function(t,e,r){"use strict";var i=r("yoF8");function n(t){return 0===t.length?i.identity:1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}}e.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n(t)},e.pipeFromArray=n},EBtg:function(t,e,r){"use strict";var i=r("2KeD"),n=r("n73p"),o=r("2qMH"),s=r("LJ/p"),c=r("HZF8"),a=r("90cg"),l=r("yRPT"),u=r("0alx");e.scheduled=function(t,e){if(null!=t){if(c.isInteropObservable(t))return i.scheduleObservable(t,e);if(a.isPromise(t))return n.schedulePromise(t,e);if(l.isArrayLike(t))return o.scheduleArray(t,e);if(u.isIterable(t)||"string"==typeof t)return s.scheduleIterable(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}},FWf1:function(t,e,r){"use strict";var i=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),n=r("pshJ"),o=r("GiSu"),s=r("zB/H"),c=r("p//D"),a=r("n3uD"),l=r("MkmW"),u=function(t){function e(r,i,n){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=o.empty;break;case 1:if(!r){s.destination=o.empty;break}if("object"==typeof r){r instanceof e?(s.syncErrorThrowable=r.syncErrorThrowable,s.destination=r,r.add(s)):(s.syncErrorThrowable=!0,s.destination=new b(s,r));break}default:s.syncErrorThrowable=!0,s.destination=new b(s,r,i,n)}return s}return i(e,t),e.prototype[c.rxSubscriber]=function(){return this},e.create=function(t,r,i){var n=new e(t,r,i);return n.syncErrorThrowable=!1,n},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(s.Subscription);e.Subscriber=u;var b=function(t){function e(e,r,i,s){var c,a=t.call(this)||this;a._parentSubscriber=e;var l=a;return n.isFunction(r)?c=r:r&&(c=r.next,i=r.error,s=r.complete,r!==o.empty&&(l=Object.create(r),n.isFunction(l.unsubscribe)&&a.add(l.unsubscribe.bind(l)),l.unsubscribe=a.unsubscribe.bind(a))),a._context=l,a._next=c,a._error=i,a._complete=s,a}return i(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=a.config.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):l.hostReportError(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;l.hostReportError(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};a.config.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(r){if(this.unsubscribe(),a.config.useDeprecatedSynchronousErrorHandling)throw r;l.hostReportError(r)}},e.prototype.__tryOrSetError=function(t,e,r){if(!a.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(i){return a.config.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=i,t.syncErrorThrown=!0,!0):(l.hostReportError(i),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(u);e.SafeSubscriber=b},GMZp:function(t,e,r){"use strict";e.isObject=function(t){return null!==t&&"object"==typeof t}},GiSu:function(t,e,r){"use strict";var i=r("n3uD"),n=r("MkmW");e.empty={closed:!0,next:function(t){},error:function(t){if(i.config.useDeprecatedSynchronousErrorHandling)throw t;n.hostReportError(t)},complete:function(){}}},HZF8:function(t,e,r){"use strict";var i=r("zfKp");e.isInteropObservable=function(t){return t&&"function"==typeof t[i.observable]}},LBXl:function(t,e,r){"use strict";e.UnsubscriptionError=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}()},"LJ/p":function(t,e,r){"use strict";var i=r("Q1FS"),n=r("zB/H"),o=r("VKeD");e.scheduleIterable=function(t,e){if(!t)throw new Error("Iterable cannot be null");return new i.Observable(function(r){var i,s=new n.Subscription;return s.add(function(){i&&"function"==typeof i.return&&i.return()}),s.add(e.schedule(function(){i=t[o.iterator](),s.add(e.schedule(function(){if(!r.closed){var t,e;try{var n=i.next();t=n.value,e=n.done}catch(o){return void r.error(o)}e?r.complete():(r.next(t),this.schedule())}}))})),s})}},MkmW:function(t,e,r){"use strict";e.hostReportError=function(t){setTimeout(function(){throw t},0)}},OAkW:function(t,e,r){"use strict";e.subscribeToArray=function(t){return function(e){for(var r=0,i=t.length;r<i&&!e.closed;r++)e.next(t[r]);e.complete()}}},Q1FS:function(t,e,r){"use strict";var i=r("yx2s"),n=r("Xwq/"),o=r("zfKp"),s=r("9AGB"),c=r("n3uD");function a(t){if(t||(t=c.config.Promise||Promise),!t)throw new Error("no Promise impl found");return t}e.Observable=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var i=this.operator,o=n.toSubscriber(t,e,r);if(o.add(i?i.call(o,this.source):this.source||c.config.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),c.config.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){c.config.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),i.canReportError(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=a(e))(function(e,i){var n;n=r.subscribe(function(e){try{t(e)}catch(r){i(r),n&&n.unsubscribe()}},i,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[o.observable]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:s.pipeFromArray(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=a(t))(function(t,r){var i;e.subscribe(function(t){return i=t},function(t){return r(t)},function(){return t(i)})})},t.create=function(e){return new t(e)},t}()},UNqx:function(t,e,r){"use strict";var i=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),n=r("q3Kh"),o=r("gTqA"),s=r("wjEo");function c(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof e?function(i){return i.pipe(c(function(r,i){return o.from(t(r,i)).pipe(n.map(function(t,n){return e(r,t,i,n)}))},r))}:("number"==typeof e&&(r=e),function(e){return e.lift(new a(t,r))})}e.mergeMap=c;var a=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new l(t,this.project,this.concurrent))},t}();e.MergeMapOperator=a;var l=function(t){function e(e,r,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var n=t.call(this,e)||this;return n.project=r,n.concurrent=i,n.hasCompleted=!1,n.buffer=[],n.active=0,n.index=0,n}return i(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(i){return void this.destination.error(i)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new s.SimpleInnerSubscriber(this),r=this.destination;r.add(e);var i=s.innerSubscribe(t,e);i!==e&&r.add(i)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(s.SimpleOuterSubscriber);e.MergeMapSubscriber=l,e.flatMap=c},VKeD:function(t,e,r){"use strict";function i(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}e.getSymbolIterator=i,e.iterator=i(),e.$$iterator=e.iterator},"Xwq/":function(t,e,r){"use strict";var i=r("FWf1"),n=r("p//D"),o=r("GiSu");e.toSubscriber=function(t,e,r){if(t){if(t instanceof i.Subscriber)return t;if(t[n.rxSubscriber])return t[n.rxSubscriber]()}return t||e||r?new i.Subscriber(t,e,r):new i.Subscriber(o.empty)}},Z5tI:function(t,e,r){"use strict";var i=r("MkmW");e.subscribeToPromise=function(t){return function(e){return t.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,i.hostReportError),e}}},gTqA:function(t,e,r){"use strict";var i=r("Q1FS"),n=r("6qA3"),o=r("EBtg");e.from=function(t,e){return e?o.scheduled(t,e):t instanceof i.Observable?t:new i.Observable(n.subscribeTo(t))}},mbIT:function(t,e,r){"use strict";e.isArray=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}()},n3uD:function(t,e,r){"use strict";var i=!1;e.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=t},get useDeprecatedSynchronousErrorHandling(){return i}}},n73p:function(t,e,r){"use strict";var i=r("Q1FS"),n=r("zB/H");e.schedulePromise=function(t,e){return new i.Observable(function(r){var i=new n.Subscription;return i.add(e.schedule(function(){return t.then(function(t){i.add(e.schedule(function(){r.next(t),i.add(e.schedule(function(){return r.complete()}))}))},function(t){i.add(e.schedule(function(){return r.error(t)}))})})),i})}},ozli:function(t,e,r){"use strict";var i=r("zfKp");e.subscribeToObservable=function(t){return function(e){var r=t[i.observable]();if("function"!=typeof r.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return r.subscribe(e)}}},"p//D":function(t,e,r){"use strict";e.rxSubscriber=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),e.$$rxSubscriber=e.rxSubscriber},poJ0:function(t,e,r){"use strict";var i=r("VKeD");e.subscribeToIterable=function(t){return function(e){for(var r=t[i.iterator]();;){var n=void 0;try{n=r.next()}catch(o){return e.error(o),e}if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof r.return&&e.add(function(){r.return&&r.return()}),e}}},pshJ:function(t,e,r){"use strict";e.isFunction=function(t){return"function"==typeof t}},q3Kh:function(t,e,r){"use strict";var i=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),n=r("FWf1");e.map=function(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new o(t,e))}};var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new s(t,this.project,this.thisArg))},t}();e.MapOperator=o;var s=function(t){function e(e,r,i){var n=t.call(this,e)||this;return n.project=r,n.count=0,n.thisArg=i||n,n}return i(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(r){return void this.destination.error(r)}this.destination.next(e)},e}(n.Subscriber)},wjEo:function(t,e,r){"use strict";var i=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),n=r("FWf1"),o=r("Q1FS"),s=r("6qA3"),c=function(t){function e(e){var r=t.call(this)||this;return r.parent=e,r}return i(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(n.Subscriber);e.SimpleInnerSubscriber=c;var a=function(t){function e(e,r,i){var n=t.call(this)||this;return n.parent=e,n.outerValue=r,n.outerIndex=i,n}return i(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(n.Subscriber);e.ComplexInnerSubscriber=a;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(n.Subscriber);e.SimpleOuterSubscriber=l;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.notifyNext=function(t,e,r,i){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(n.Subscriber);e.ComplexOuterSubscriber=u,e.innerSubscribe=function(t,e){if(!e.closed)return t instanceof o.Observable?t.subscribe(e):s.subscribeTo(t)(e)}},yRPT:function(t,e,r){"use strict";e.isArrayLike=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t}},yoF8:function(t,e,r){"use strict";e.identity=function(t){return t}},yx2s:function(t,e,r){"use strict";var i=r("FWf1");e.canReportError=function(t){for(;t;){var e=t.destination;if(t.closed||t.isStopped)return!1;t=e&&e instanceof i.Subscriber?e:null}return!0}},"zB/H":function(t,e,r){"use strict";var i=r("mbIT"),n=r("GMZp"),o=r("pshJ"),s=r("LBXl");function c(t){return t.reduce(function(t,e){return t.concat(e instanceof s.UnsubscriptionError?e.errors:e)},[])}e.Subscription=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this,a=r._parentOrParents,l=r._ctorUnsubscribe,u=r._unsubscribe,b=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,a instanceof t)a.remove(this);else if(null!==a)for(var h=0;h<a.length;++h)a[h].remove(this);if(o.isFunction(u)){l&&(this._unsubscribe=void 0);try{u.call(this)}catch(f){e=f instanceof s.UnsubscriptionError?c(f.errors):[f]}}if(i.isArray(b)){h=-1;for(var d=b.length;++h<d;){var p=b[h];if(n.isObject(p))try{p.unsubscribe()}catch(f){e=e||[],f instanceof s.UnsubscriptionError?e=e.concat(c(f.errors)):e.push(f)}}}if(e)throw new s.UnsubscriptionError(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var i=r;(r=new t)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var n=r._parentOrParents;if(null===n)r._parentOrParents=this;else if(n instanceof t){if(n===this)return r;r._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return r;n.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[r]:o.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=((e=new t).closed=!0,e),t}()},zfKp:function(t,e,r){"use strict";e.observable=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()}}]);
//# sourceMappingURL=11.3f8a5a1c048bccadd78e.js.map