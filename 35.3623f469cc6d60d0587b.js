(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{Ikb4:function(t,e,o){"use strict";o.r(e),o.d(e,"EditTestdrivePageModule",function(){return G});var r=o("ofXK"),s=o("3Pt+"),i=o("TEn/"),n=o("tyNb"),a=o("quSY"),c=o("Cfvw"),l=o("5+tZ"),d=o("vkgz"),m=o("lJxs"),b=o("JIr8"),u=o("pLZG"),h=o("/uUt"),g=o("SJsC"),p=o("lzGV"),v=o("AytR"),f=o("VOuF"),C=o("UsUu"),y=o("fXoL"),M=o("sYmb"),F=o("6GcI"),N=o("nC5Y"),x=o("FpxV"),I=o("0C1u"),D=o("gE7l");function T(t,e){if(1&t&&(y.Nb(0,"ion-select-option",7),y.xc(1),y.Mb()),2&t){const t=e.$implicit;y.gc("value",t.value),y.xb(1),y.zc(" ",t.label," ")}}let O=(()=>{class t{constructor(t,e){this.translate=t,this.contactService=e,this.tdChange=new y.o,this.countryList=this.contactService.getCountryList()}ngOnInit(){this.addToForm()}ngOnChanges(t){t.testdrive&&(this.testDriveSG=t.testdrive.currentValue)}emit(){this.testDriveSG.Line1=this.form.get("line1").value,this.testDriveSG.Line2=this.form.get("line2").value,this.testDriveSG.PostalCode=this.form.get("postalCode").value,this.testDriveSG.Country=this.form.get("country").value,this.tdChange.emit(this.testDriveSG)}addToForm(){this.form&&(this.form.addControl("line1",new s.b("",[s.l.required])),this.form.addControl("line2",new s.b("")),this.form.addControl("country",new s.b(null)),this.form.addControl("postalCode",new s.b("",[s.l.required])),this.updateFormMsg())}updateFormMsg(){this.translate.get("Error_CannotBeEmpty").subscribe(t=>{this.messages.line1={required:t},this.messages.postalCode={required:t}})}}return t.\u0275fac=function(e){return new(e||t)(y.Ib(M.d),y.Ib(x.a))},t.\u0275cmp=y.Cb({type:t,selectors:[["app-tdform-sg"]],inputs:{form:"form",messages:"messages",testdrive:"testdrive"},outputs:{tdChange:"tdChange"},features:[y.vb],decls:19,vars:22,consts:[[3,"formGroup"],["debounce","500","formControlName","line1",3,"placeholder","ionChange"],[3,"control","messages"],["debounce","500","formControlName","line2",3,"placeholder","ionChange"],["formControlName","country","readonly","",3,"placeholder","ionChange"],[3,"value",4,"ngFor","ngForOf"],["debounce","500","formControlName","postalCode",3,"placeholder","ionChange"],[3,"value"]],template:function(t,e){1&t&&(y.Lb(0,0),y.Nb(1,"ion-item"),y.Nb(2,"ion-input",1),y.Vb("ionChange",function(){return e.emit()}),y.ac(3,"translate"),y.Mb(),y.Mb(),y.Jb(4,"app-item-err",2),y.Nb(5,"ion-item"),y.Nb(6,"ion-input",3),y.Vb("ionChange",function(){return e.emit()}),y.ac(7,"translate"),y.Mb(),y.Mb(),y.Jb(8,"app-item-err",2),y.Nb(9,"ion-item"),y.Nb(10,"ion-select",4),y.Vb("ionChange",function(){return e.emit()}),y.ac(11,"translate"),y.vc(12,T,2,2,"ion-select-option",5),y.Mb(),y.Mb(),y.Jb(13,"app-item-err",2),y.Nb(14,"ion-item"),y.Nb(15,"ion-input",6),y.Vb("ionChange",function(){return e.emit()}),y.ac(16,"translate"),y.Mb(),y.Mb(),y.Jb(17,"app-item-err",2),y.Jb(18,"ion-item"),y.Kb()),2&t&&(y.gc("formGroup",e.form),y.xb(2),y.hc("placeholder",y.bc(3,14,"EditTestdrivePage_Line1")),y.xb(2),y.gc("control",null==e.form.controls?null:e.form.controls.line1)("messages",e.messages.line1),y.xb(2),y.hc("placeholder",y.bc(7,16,"EditTestdrivePage_Line2")),y.xb(2),y.gc("control",null==e.form.controls?null:e.form.controls.line2)("messages",e.messages.line2),y.xb(2),y.hc("placeholder",y.bc(11,18,"EditTestdrivePage_Country")),y.xb(2),y.gc("ngForOf",e.countryList),y.xb(1),y.gc("control",null==e.form.controls?null:e.form.controls.country)("messages",e.messages.country),y.xb(2),y.hc("placeholder",y.bc(16,20,"EditTestdrivePage_PostalCode")),y.xb(2),y.gc("control",null==e.form.controls?null:e.form.controls.postalCode)("messages",e.messages.postalCode))},directives:[s.i,s.d,i.B,i.A,i.tb,s.h,s.c,D.a,i.X,i.sb,r.l,i.Y],pipes:[M.c],styles:["ion-select[_ngcontent-%COMP%]{width:100%}"]}),t})();function E(t,e){if(1&t&&(y.Nb(0,"ion-select-option",18),y.xc(1),y.Mb()),2&t){const t=e.$implicit;y.gc("value",t.value),y.xb(1),y.yc(t.label)}}function S(t,e){1&t&&(y.Nb(0,"ion-item"),y.Jb(1,"ion-input",19),y.ac(2,"translate"),y.Mb()),2&t&&(y.xb(1),y.hc("placeholder",y.bc(2,1,"EditTestdrive_DrivingLicense")))}function w(t,e){if(1&t&&(y.Nb(0,"ion-item"),y.Jb(1,"ion-datetime",20),y.ac(2,"translate"),y.Mb()),2&t){const t=y.Zb();y.xb(1),y.hc("max",t.maxdate),y.hc("placeholder",y.bc(2,2,"EditTestdrive_ExpiryDate"))}}function J(t,e){if(1&t&&y.Jb(0,"app-item-err",7),2&t){const t=y.Zb();y.gc("control",null==t.tdForm.controls?null:t.tdForm.controls.expDate)("messages",t.formErrorMessages.expDate)}}function _(t,e){if(1&t){const t=y.Ob();y.Nb(0,"app-tdform-sg",21),y.Vb("tdChange",function(e){return y.qc(t),y.Zb().setTestdrive(e)}),y.Mb()}if(2&t){const t=y.Zb();y.gc("form",t.tdForm)("testdrive",t.testdrive)("messages",t.formErrorMessages)}}function j(t,e){if(1&t&&(y.Nb(0,"ion-item"),y.Jb(1,"ion-datetime",22),y.ac(2,"translate"),y.Mb()),2&t){const t=y.Zb();y.xb(1),y.hc("max",t.maxdate),y.hc("placeholder",y.bc(2,2,"EditTestdrive_PlannedStartDate"))}}const L=[{path:":"+C.a.PARAM_ID,children:[{path:"",component:(()=>{class t{constructor(t,e,o,r,s,i,n,c,l,d,m){this.route=t,this.router=e,this.translate=o,this.testdriveSrvc=r,this.formBuilder=s,this.oppService=i,this.loadingCtrl=n,this.navCtrl=c,this.contactService=l,this.auth=d,this.modalController=m,this.subs=new a.a,this.countryCode=v.a.countryCode,this.maxdate=new Date((new Date).setFullYear((new Date).getFullYear()+5)).getFullYear(),this.docList=this.contactService.getContactDocType()}ngOnInit(){this.tdForm=this.initTdForm(),this.subs.add(this.parseURL())}parseURL(){return this.testdrive=new p.a,this.route.paramMap.subscribe(t=>{this.testdrive.Id=t.get(C.a.PARAM_ID),this.testdrive.Id===C.a.PARAM_ID?(console.log(this.testdrive),this.translate.get("EditTestdrivePage_New").subscribe(t=>{this.pageTitle=t})):this.translate.get("EditTestdrivePage_Edit").subscribe(t=>{this.pageTitle=t,this.getTestdriveInfo(this.testdrive.Id)}),this.router.getCurrentNavigation().extras.state&&(this.states=this.router.getCurrentNavigation().extras.state,this.testdrive.OpportunityId=this.states[C.a.STATE_OPPID]),this.getData()})}initTdForm(){const t=this.formBuilder.group({id:[""],name:["",s.l.required],docType:["",s.l.required],docNum:["",s.l.required],birthday:["",s.l.required],gender:["",s.l.required],drivingLicense:["",s.l.required],modelInterest:["",s.l.required],expDate:[""],plannedStartDate:["",s.l.required]});return this.initErrorMessages(t),t}initErrorMessages(t){this.translate.get("Error_CannotBeEmpty").subscribe(e=>{if(this.formErrorMessages={group:{}},t)for(const o of Object.keys(t.controls))switch(o){case"drivingLicense":case"expDate":case"plannedStartDate":this.formErrorMessages[o]={required:e}}})}getData(){this.translate.get("Common_Loading").pipe(Object(l.b)(t=>Object(c.a)(this.loadingCtrl.create({message:t}))),Object(l.b)(t=>(t.present(),this.oppService.getOpportunityById(this.testdrive.OpportunityId).pipe(Object(d.a)(e=>{this.opp=e,t.dismiss()},e=>{t.dismiss()}),Object(l.b)(e=>(console.log(e),this.contactService.getContactById(e.ContactId).pipe(Object(d.a)(e=>{this.testdrive.Contact=e,this.updateForm(),t.dismiss()},e=>{t.dismiss()})))),Object(m.a)(e=>t),Object(b.a)(e=>{throw t.dismiss(),e})))),Object(l.b)(t=>{return this.auth.subUser().pipe(Object(u.a)(t=>null!=t&&t.isLoggedIn&&!!t.company),(e="userId",Object(h.a)((t,o)=>t[e]===o[e])),Object(l.b)(e=>this.testdriveSrvc.getTdModels(new Set(e.company.map(t=>t.Name))).pipe(Object(d.a)(e=>{console.log(e),t.dismiss()},e=>{t.dismiss()}))),Object(m.a)(e=>t),Object(b.a)(e=>{throw t.dismiss(),e}));var e})).subscribe(t=>{t.dismiss()})}updateForm(){this.tdForm.get("name").setValue(this.testdrive.Contact.Name),this.tdForm.get("docType").setValue(this.testdrive.Contact.DocType),this.tdForm.get("docNum").setValue(this.testdrive.Contact.DocNum),this.tdForm.get("birthday").setValue(this.testdrive.Contact.Birthday),this.tdForm.get("gender").setValue(this.testdrive.Contact.Gender)}getTestdriveInfo(t){this.testdriveSrvc.getTestdrivesById(t).subscribe(t=>{this.testdrive=t,console.log(t)})}setTestdrive(t){this.testdrive=t,console.log(this.testdrive)}showModelInterestComp(){console.log("test"),this.opp.Company&&Object(c.a)(this.modalController.create({component:g.a,componentProps:{cmp:this.opp.Company,team:"",selectedValues:this.tdForm.get("modelInterest").value,singleSelect:!0}})).subscribe(t=>{Object(c.a)(t.onDidDismiss()).subscribe(t=>{if(t&&t.data){const e=t.data.map(t=>t);JSON.stringify(this.tdForm.get("modelInterest").value)!==JSON.stringify(e)&&(this.modelSelected=e[0],this.tdForm.get("modelInterest").setValue(this.modelSelected.label),this.tdForm.markAsDirty())}}),t.present()})}done(){this.testdrive.Contact.Name=this.tdForm.get("name").value,this.testdrive.Contact.DocType=this.tdForm.get("docType").value,this.testdrive.Contact.DocNum=this.tdForm.get("docNum").value,this.testdrive.Contact.Birthday=this.tdForm.get("birthday").value,this.testdrive.Contact.Gender=this.tdForm.get("gender").value,this.testdrive.ModelId=this.modelSelected.value,this.testdrive.PlannedStartDate=this.tdForm.get("plannedStartDate").value,this.translate.get("Common_Saving").pipe(Object(l.b)(t=>Object(c.a)(this.loadingCtrl.create({message:t}))),Object(l.b)(t=>(t.present(),this.testdriveSrvc.insertTestdrive(this.testdrive).pipe(Object(d.a)(e=>{console.log(e),this.testdrive=e,t.dismiss()},e=>{t.dismiss()}))))).subscribe(t=>{this.tdForm.reset(),this.navCtrl.back(),setTimeout(t=>{this.navCtrl.navigateForward(f.a.BASE+"/"+this.testdrive.Id)},1e3)})}}return t.\u0275fac=function(e){return new(e||t)(y.Ib(n.a),y.Ib(n.g),y.Ib(M.d),y.Ib(F.a),y.Ib(s.a),y.Ib(N.a),y.Ib(i.mb),y.Ib(i.ob),y.Ib(x.a),y.Ib(I.a),y.Ib(i.nb))},t.\u0275cmp=y.Cb({type:t,selectors:[["app-edit-testdrive"]],decls:44,vars:45,consts:[["color","primary","mode","ios"],["slot","start"],["defaultHref","",3,"text"],["slot","end"],[3,"click"],[3,"formGroup"],["formControlName","name",3,"placeholder"],[3,"control","messages"],["formControlName","docType","size","12",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","docNum",3,"placeholder"],["formControlName","birthday","displayFormat","DD MMM YYYY",3,"placeholder"],["formControlName","gender",3,"placeholder"],["lines","none"],["formControlName","modelInterest","placeholder","Model Interest",1,"w100",3,"ionFocus"],[4,"ngIf"],[3,"control","messages",4,"ngIf"],[3,"form","testdrive","messages","tdChange",4,"ngIf"],[3,"value"],["formControlName","drivingLicense",3,"placeholder"],["displayFormat","DD-MM-YYYY","formControlName","expDate",3,"max","placeholder"],[3,"form","testdrive","messages","tdChange"],["displayFormat","DD MMM YYYY hh:mm A","formControlName","plannedStartDate",3,"max","placeholder"]],template:function(t,e){1&t&&(y.Nb(0,"ion-header"),y.Nb(1,"ion-toolbar",0),y.Nb(2,"ion-buttons",1),y.Jb(3,"ion-back-button",2),y.ac(4,"translate"),y.Mb(),y.Nb(5,"ion-buttons",3),y.Nb(6,"ion-button",4),y.Vb("click",function(){return e.done()}),y.xc(7),y.ac(8,"translate"),y.Mb(),y.Mb(),y.Nb(9,"ion-title"),y.xc(10),y.Mb(),y.Mb(),y.Mb(),y.Nb(11,"ion-content"),y.Nb(12,"form",5),y.Nb(13,"ion-item"),y.Jb(14,"ion-input",6),y.ac(15,"translate"),y.Mb(),y.Jb(16,"app-item-err",7),y.Nb(17,"ion-item"),y.Nb(18,"ion-select",8),y.ac(19,"translate"),y.vc(20,E,2,2,"ion-select-option",9),y.Mb(),y.Mb(),y.Jb(21,"app-item-err",7),y.Nb(22,"ion-item"),y.Jb(23,"ion-input",10),y.ac(24,"translate"),y.Mb(),y.Jb(25,"app-item-err",7),y.Nb(26,"ion-item"),y.Jb(27,"ion-datetime",11),y.ac(28,"translate"),y.Mb(),y.Jb(29,"app-item-err",7),y.Nb(30,"ion-item"),y.Jb(31,"ion-input",12),y.ac(32,"translate"),y.Mb(),y.Jb(33,"app-item-err",7),y.Nb(34,"ion-item",13),y.Nb(35,"ion-input",14),y.Vb("ionFocus",function(){return e.showModelInterestComp()}),y.Mb(),y.Mb(),y.Jb(36,"app-item-err",7),y.vc(37,S,3,3,"ion-item",15),y.Jb(38,"app-item-err",7),y.vc(39,w,3,4,"ion-item",15),y.vc(40,J,1,2,"app-item-err",16),y.vc(41,_,1,3,"app-tdform-sg",17),y.vc(42,j,3,4,"ion-item",15),y.Jb(43,"app-item-err",7),y.Mb(),y.Mb()),2&t&&(y.xb(3),y.hc("text",y.bc(4,31,"Common_Back")),y.xb(4),y.yc(y.bc(8,33,"Common_Done")),y.xb(3),y.yc(e.pageTitle),y.xb(2),y.gc("formGroup",e.tdForm),y.xb(2),y.hc("placeholder",y.bc(15,35,"EditTestdrive_Name")),y.xb(2),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.name)("messages",e.formErrorMessages.name),y.xb(2),y.hc("placeholder",y.bc(19,37,"EditContact_ID")),y.xb(2),y.gc("ngForOf",e.docList),y.xb(1),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.docType)("messages",e.formErrorMessages.docType),y.xb(2),y.hc("placeholder",y.bc(24,39,"EditTestdrive_DocumentNumber")),y.xb(2),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.docNum)("messages",e.formErrorMessages.docNum),y.xb(2),y.hc("placeholder",y.bc(28,41,"EditTestdrive_Birthday")),y.xb(2),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.birthday)("messages",e.formErrorMessages.birthday),y.xb(2),y.hc("placeholder",y.bc(32,43,"EditTestdrive_Gender")),y.xb(2),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.gender)("messages",e.formErrorMessages.gender),y.xb(3),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.modelInterest)("messages",e.formErrorMessages.modelInterest),y.xb(1),y.gc("ngIf","my"==e.countryCode),y.xb(1),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.drivingLicense)("messages",e.formErrorMessages.drivingLicense),y.xb(1),y.gc("ngIf","my"==e.countryCode),y.xb(1),y.gc("ngIf","my"==e.countryCode),y.xb(1),y.gc("ngIf","my"==e.countryCode),y.xb(1),y.gc("ngIf","my"==e.countryCode),y.xb(1),y.gc("control",null==e.tdForm.controls?null:e.tdForm.controls.plannedStartDate)("messages",e.formErrorMessages.plannedStartDate))},directives:[i.w,i.ib,i.i,i.f,i.g,i.h,i.hb,i.q,s.m,s.i,s.d,i.B,i.A,i.tb,s.h,s.c,D.a,i.X,i.sb,r.l,i.r,r.m,i.Y,O],pipes:[M.c],styles:["ion-content[_ngcontent-%COMP%]{--background:var(--ion-color-content-color)}form[_ngcontent-%COMP%]{background:#fff}"]}),t})(),pathMatch:"full"}]}];let P=(()=>{class t{}return t.\u0275mod=y.Gb({type:t}),t.\u0275inj=y.Fb({factory:function(e){return new(e||t)},imports:[[n.i.forChild(L)],n.i]}),t})();var Y=o("CJCG");let G=(()=>{class t{}return t.\u0275mod=y.Gb({type:t}),t.\u0275inj=y.Fb({factory:function(e){return new(e||t)},imports:[[r.c,s.e,s.k,M.b,i.kb,P,Y.a]]}),t})()}}]);
//# sourceMappingURL=35.3623f469cc6d60d0587b.js.map